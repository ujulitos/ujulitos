<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>BMV - ACTIO</title>
    <link rel="icon" type="image/png" href="templateImages/actiologo.png">
    <link rel="apple-touch-icon" href="templateImages/actiologo.png">
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <script src="SCORM_API_wrapper.js"></script>
    <script src="js/utils.js"></script>
    <style>
        .imgBtn {
            cursor: pointer;
            margin: auto;
            z-index: -1;
        }

        .imgIn {
            display: inline-block;
            margin: auto;
        }

        .titulo {
            font-family: Verdana, Arial, Helvetica;
            font-size: 16pt;
            color: #FFFFFF;
        }

        .marcador {
            font-family: Verdana, Arial, Helvetica;
            font-size: 9pt;
            color: #FFFFFF;
        }

        .ligloss {
            font-family: Helvetica, Verdana, Arial;
            font-size: 12pt;
        }

        .ligloss:hover {
            font-weight: bold;
        }

        .liglossBold {
            font-family: Helvetica, Verdana, Arial;
            font-size: 12pt;
            font-weight: bold;
        }

        .def {
            font-family: Helvetica, Verdana, Arial;
            font-size: 12pt;
        }


        #modalBloq {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            height: 100%;
            width: 100%;
            top: 0;
            left: 0;
            text-align: center;
            z-index: 999;
            display: none;
        }

        #modalBloq_int {
            position: absolute;
            width: 642px;
            height: 318px;
            left: 50%;
            top: 45%;
            margin: -160px 0 0 -320px;
        }

        #modalBloq_img {
            left: 60px;
        }

        #modalBloq_boton {
            margin-top: 0px;
            transition: .5s ease;
            /* background-color: #F6921E; */
            border-radius: 50px;
            -webkit-border-radius: 50px;
            -moz-border-radius: 50px;
            cursor: pointer;
        }

        #modalBloq_boton:hover {
            /* background-color: #ff6600; */
            transform: scale(1.1);
        }

        @font-face {
            font-family: RobotoLight;
            src: url('fonts/Roboto-Light.ttf') format("truetype");
        }

        @font-face {
            font-family: RobotoRegular;
            src: url('fonts/Roboto-Regular.ttf') format("truetype");
        }
    </style>
</head>

<body style="overflow: hidden;" onblur="saveSCORM();">
    <div class="container-fluid">
        <div class="row" id="rowHeader">
            <!-- row header-->
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="height:50px;background-color:rgb(37, 68, 104);margin:auto;">
                <div class="row" id="divSuperior" style="display:none;">
                    <!--col-lg-1 col-md-1 col-sm-1 col-xs-1-->
                    <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1">
                        <img id="menuIcon" src="templateImages/menuIcon.png" class="imgBtn" style="z-index: 400;padding:4px" onclick='showMap();' />
                    </div>
                    <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-left">
                        <div id="divTitle" class="text-left" style="color:#FFFFFF;margin-top: 10px;font-weight: bold;"> </div>
                    </div>
                    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                        <div><img src="templateImages/BMVLogo-sm.png" /> </div>
                    </div>
                    <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">

                    </div>
                    <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1">
                        <img src="templateImages/helpIcon.png" class="imgBtn" id="imgHelp" style="z-index:400;padding:4px " data-toggle="tooltip" data-placement="bottom" title="Ayuda" onmouseover="$('#imgHelp').tooltip('show');" onclick="showAyuda();" />
                    </div>
                </div> <!-- row -->
                <div class="row">
                    <div style="position:absolute;z-index:400;width:100%;background-color:transparent;">
                        <div id="menubar" style="display:none;z-index:400;width:120px;">
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="left:-45px;">
                                <ul style="list-style-type:none;">
                                    <li><img src="templateImages/map.png" class="img-responsive imgBtn" id="imgmapa" style="margin:4px;" onmouseover="clearTimeout(idTimeout);over(0,this);$('#imgmapa').tooltip('show');" onmouseout="out(0,this);idTimeout=setTimeout('hideMenu()',500);" onclick="showMap();" data-toggle="tooltip" data-placement="right" title="Mapa de Aprendizaje" /></li>
                                    <li><img src="templateImages/birrete.png" class="img-responsive imgBtn" id="imgbirrete" style="margin:4px;" onmouseover="clearTimeout(idTimeout);over(1,this);$('#imgbirrete').tooltip('show');" onmouseout="out(1,this);idTimeout=setTimeout('hideMenu()',500);" data-toggle="tooltip" data-placement="right" title="Gu&iacute;a Did&aacute;ctica" onclick="showGuia();" /></li>
                                    <li><a href="assets/guia.pdf" target="_blank"><img src="templateImages/guiarapida.png" class="img-responsive imgBtn" id="imgguia" style="margin:4px;" onmouseover="clearTimeout(idTimeout);over(3,this); $('#imgguia').tooltip('show');" onmouseout="out(3,this);idTimeout=setTimeout('hideMenu()',500);" data-toggle="tooltip" data-placement="right" title="Gu&iacute;a de Referencia" /></a></li>
                                    <li><img src="templateImages/salir.png" class="img-responsive imgBtn" id="imgsalir" style="margin:4px;" onmouseover="clearTimeout(idTimeout);over(4,this);$('#imgsalir').tooltip('show');" onmouseout="out(4,this);idTimeout=setTimeout('hideMenu()',500);" onclick="exitWindow();" data-toggle="tooltip" data-placement="right" title="Salir" /></li>
                                </ul>
                            </div>
                        </div> <!--  menubar-->
                    </div>
                </div><!-- row -->
            </div> <!-- header -->
        </div> <!-- row header-->
        <div class="row text-center" style="background-color: #FFFFFF;overflow:hidden;overflow-y: hidden;overflow-x: hidden;background-image: url(templateImages/loading.gif);background-position: center;background-repeat: no-repeat;">
            <div id="divContent" class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="height:340px;overflow:hidden;overflow-y: hidden;overflow-x: hidden;background-color:#F9F9F9;background-image: url(templateImages/loading.gif);background-position: center;background-repeat: no-repeat;z-index:1;">
                <!-- br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/-->
                <!-- img src="templateImages/loading.gif" class="img-responsive center-block" style=" vertical-align: middle;max-height: 500px;" -->
                <!-- iframe id="iContent" name="iContent" src="" frameborder="0" scrolling="no" height="500" width="100%"> </iframe-->
            </div>
            <div id="divBack" style="display:none;background-image: url(templateImages/loading.gif);background-position: center;background-repeat: no-repeat;z-index:14000;">
            </div> <!-- divBack -->
        </div> <!-- row content-->
        <div class="row" id="divInferior" style="display:none;height:40px; position:fixed; margin-bottom: 0px; width:100%;">
            <!-- row controls-->
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="background-color: rgb(37, 68, 104);height: inherit;">
                <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2" style="height:inherit;">
                    <div class="titulo" id="titulo" style="height: 100%;vertical-align: middle;display:inline-block;"> </div>
                </div>
                <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8 text-center" style="height:inherit;">
                    <table style="height:12px;" width="50%" height="12px" border="0" align="center">
                        <tr>
                            <canvas id="canvasProgress" width="400" height="7px" class="img-responsive" style="display:inline;"></canvas>
                            <div id="marcador" class="marcador text-center" style="font-size: 8pt;color:#4AAA42;">
                        </tr>
                        <td colspan="12">
                            <div id="marcador" class="marcador text-center" style="font-size: 8pt;"></div>
                        </td>
                        </tr>
                    </table>
                </div>
                <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1 text-right" style="height:inherit;vertical-align: middle;padding:0px;">
                    <img src="templateImages/prevIcon-sm_out.png" class="" onmouseover="changeOver(this);" onmouseout="changeOut(this);" onClick="prevSlide();" style="cursor:pointer;height:40px;padding-top:0px;padding-bottom:0px;padding-left: 0px;padding-right: 0px;margin-right: 0px;" />
                </div>
                <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1 text-left" style="height:inherit;vertical-align: middle;padding:0px;">
                    <img src="templateImages/nextIcon-sm_out.png" class="" onmouseover="changeOver(this);" onmouseout="changeOut(this);" onClick="nextSlide();" style="cursor:pointer;height:40px;padding:0px;padding-top:0px;padding-bottom:0px;padding-right: 0px;margin-left: 0px;" />
                </div>
            </div> <!-- footer -->
        </div> <!-- row controls-->
    </div> <!-- container-fluid -->

    <div id="divSim" style="position: absolute;top:0;left:0; width:1900px; height:1768px;background-color:rgba(52,52,52,1);display:none;">
        <img src="templateImages/loading.gif" class="img-responsive center-block" style=" vertical-align: middle;max-height: 500px;">
    </div>

    <div id="divGlossary" style="position: absolute;top:0;left:0; width:1900px; height:1768px;background-color:rgba(52,52,52,1);display:none;">
        <div class="row" style="border-bottom: rgb(0,186,208) thin solid;">
            <div class="col-lg-offset-2 col-lg-8 col-md-offset-2 col-md-8 col-sm-offset-2 col-sm-8 col-xs-offset-2 col-xs-8" style="padding-left:40px; padding-bottom:5px;">
                <img src="templateImages/glosariotext-sm.png" style="margin-top:15px;" />
                <div style="display:inline;color:rgb(255,255,255);"></div>
            </div>
            <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" onclick="closeGlossary();">
                <img src="templateImages/cerrar-xs.png" class="img-responsive" style="cursor:pointer; margin-top:15px" onclick="closeGlossary();" />
            </div>
        </div>
        <!--row -->
        <div class="row">
            <div id="divterm" class="col-lg-offset-2 col-lg-2 col-md-offset-2 col-md-2 col-sm-offset-2 col-sm-2 col-xs-offset-2 col-xs-2" style="border-right: thin solid rgb(0,186,208);color:rgb(255,255,255);padding-top: 10px;">
            </div>
            <div class=" col-lg-6 col-md-6 col-sm-6 col-xs-6">
                <div id="divdef" class="def" style="color:rgb(255,255,255);padding-top: 10px;">

                </div>
            </div>
        </div>
    </div> <!-- row divGlossary-->
    <div id="divGuia" style="position: absolute;top:0;left:0; width:1200px; height:1768px;background-color:rgba(52,52,52,1);display:none;">
        <div class="row">
            <div class="col-lg-offset-1 col-lg-10 col-md-offset-1 col-md-10 col-sd-offset-1 col-sm-7" style="padding-left:40px; padding-bottom:5px;" id="subDivGuia">
                <object type="text/html" data="content/cur_w10_didactica/cur_w10_didactica.html" style="position:absolute;top:0;left:0;width:100%;height:580px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;overflow:hidden;margin:0px;" id="objectGuia"></object>
            </div>
        </div>
        <!--row -->
    </div> <!-- divGuia -->

    <div id="divAyuda" style="position: absolute;top:0;left:0; width:1200px; height:1768px;background-color:rgba(52,52,52,1);display:none;">
        <div class="row">
            <div class="col-lg-offset-1 col-lg-10 col-md-offset-1 col-md-10 col-sd-offset-1 col-sm-7" style="padding-left:40px; padding-bottom:5px;" id="subDivAyuda">
                <object type="text/html" data="content/bmv_ayuda.html" style="position:absolute;top:0;left:0;width:100%;height:580px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;overflow:hidden;margin:0px;" id="objectAyuda"></object>
            </div>
        </div>
        <!--row -->
    </div> <!-- divAyuda -->

    <!-- background-color:rgba(52,52,52,1); -->
    <div class="container-fluid">
        <div id="divMapa" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="display:none;">
            <div class="row" id="divMapaContent">
                <!-- Content -->
            </div>
            <!--row Content -->
        </div> <!-- divMapa -->
    </div> <!-- container-fluid -->

    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" id="warningModal">
        <div id="modalBloq_int" class="modal-dialog modal-lg" role="document">
            <div class="modal-content text-center" style="background-color: rgba(0,0,0,0);box-shadow: none;border:none;">
                <img id="modalBloq_img" src="templateImages/atencion_02.png" /> <br />
                <br />
                <button id="modalBloq_boton" type="button" class="btn btn-danger" data-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div> <!-- modal-->


    <script src="js/jquery.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <script src="js/ie10-viewport-bug-workaround.js"></script>
    <script src="jspdf.debug.js" type="text/javascript"></script>
    <script language="javascript" type="text/javascript">
        var conCandado = true;
        var pantallaDesbloqueada = false;
        var idTimeout;
        var current = 0;
        var load = false;
        var laEscalaWidth = 1;
        var scaleTemplate = 1;
        var maxHeight = 768;
        var height = 580;
        var width = 1000;

        var divSuperiorHeight = 50;
        var divInferiorHeight = 37;
        var laEscalaHeight = ($(window).height() - divSuperiorHeight - divInferiorHeight);

        var suspendData;
        var lmsData;
        var graphMain;
        var graphModules;
        var contentModules;
        var califPass = 80;

        var romanNum = new Array();
        romanNum[0] = "I ";
        romanNum[1] = "II ";
        romanNum[2] = "III ";
        romanNum[3] = "IV ";
        romanNum[4] = "V ";
        romanNum[5] = "VI ";


        function registra(dato) {
            console.log(dato);
        } //registra

        var scorm = pipwerks.SCORM;
        var learnername = "none";
        scorm.version = "1.2";
        var lmsConnected = false;
        var scorm = pipwerks.SCORM;
        registra("Inicio...");
        registra("SCORM.version: " + scorm.version);
        var learnername = "none";
        var lmsConnected = false;
        try {
            lmsConnected = scorm.connection.initialize();
            if (scorm.version == "1.2") {
                learnername = scorm.get("cmi.core.student_name");
            } else if (scorm.version == "2004") {
                learnername = scorm.get("cmi.learner_name");
            } // if scorm.version
        } catch (e) {
            registra("No fue posible se inicializar scorm" + e.message);
        } //catch
        registra("initialize: " + lmsConnected);
        registra("learnerName: " + learnername);

        function closeCourseWindow() {
            this.parent.window.close();
        } //closeCourseWindow

        var unloaded = false;

        function unloadHandler() {
            if (!unloaded) {

                suspendData = JSON.stringify(suspendObject);

                console.log('el suspend data es', suspendData);
                suspendData = suspendData.replace(/"/g, '|');
                console.log('el nuevo suspend data es', suspendData);

                scorm.set("cmi.suspend_data", suspendData);

                scorm.save(); //save all data that has already been sent
                // pipwerks.SCORM.quit(); //close the SCORM API connection properly
                unloaded = true;
            }
        } //unloadHandler
        window.onbeforeunload = unloadHandler;
        window.onunload = unloadHandler;

        /*---------------------------------------------------------------------*/
        var userScore = 0;
        var numPre = 0;
        var puntos = 0;
        var puntosTotal = 0;
        var puntosTotalPr = 0;

        //[total] : Número total de preguntas de la evaluación final. 
        function addPoint(punto, max) {
            console.log('addPoint', punto, ' y max', max);
            puntosTotal++;
            userScore = Math.floor((puntosTotal * 100) / max);
            registra("addPoint: userScore: " + userScore);
            suspendObject.aprobo = (userScore >= 80);
            registra("addPoint aprobo: " + (userScore >= 80));
            // suspendObject.caliFinal[suspendObject.intentos - 1] = userScore;
            suspendObject.caliFinal = userScore;
            setScore();
        } //addPoint

        function addNoPoint(max) {
            console.log('addNoPoint');
            // puntos++;
            // puntosTotal = total;
            userScore = Math.floor((puntosTotal * 100) / max);
            registra("addNoPoint: userScore: " + userScore);
            suspendObject.aprobo = (userScore >= 80);
            registra("addNoPoint aprobo: " + (userScore >= 80));
            // suspendObject.caliFinal[suspendObject.intentos - 1] = userScore;
            suspendObject.caliFinal = userScore;
            setScore();
        } //addPoint

        // [module_]: Número del módulo de la práctica (se utiliza module_ por que la palabra module es reservada)
        // [practice]: Número de la práctica dentro del módulo
        // [point] :  Número del punto dentro de la práctica
        // [total] : Total de preguntas de la práctica
        function addPointPr(module_, practice, point, total) {
            var modulePractice = -1;

            registra("addPointPr - module: " + module_ + " -practice: " + practice + " -point: " + point + " -total: " + total);

            for (var i = 0; i < abilityItemsArray.length; i++) {
                if ((abilityItemsArray[i].module == module_) && (abilityItemsArray[i].number == practice)) {
                    registra("addPointPr - module: " + module_ + " -practice: " + practice + " found ... " + i);
                    modulePractice = i; // aquí se guarda el índice para saber el elemento fuera del ciclo
                    if (abilityDataArray[i].length == 0) { // Si es el primer punto registrado se genera todo el arreglo con ceros para poder sacar el total
                        registra("addPointPr - generate abilityDataArray - " + total);
                        abilityDataArray[i] = new Array(total);
                        for (var j = 0; j < total; j++) {
                            abilityDataArray[i][j] = 0;
                        } // for j < total
                    } //  if (abilityDataArray[i].length==0)
                    if (point <= abilityDataArray[i].length) {
                        registra("addPointPr - " + point + " - 1 ....");
                        // for para limpiar el arreglo desde el punto en adelante.
                        for (var j = (point - 1); j < abilityDataArray[i].length; j++) {
                            abilityDataArray[i][j] = 0;
                        } // j 
                        abilityDataArray[i][point - 1] = 1;
                    } // if (point < abilityDataArray[i].length) {
                    // dentro del arreglo abilityDataArray[i][point] = 1 
                    // donde i es el módulo y práctica 
                    // y point es el punto obtenido
                    break;
                } // if 
            } // for i abilityItemsArray
            var totI = 0;

            for (var j = 0; j < abilityDataArray[modulePractice].length; j++) {
                registra("abilityDataArray[" + modulePractice + "][" + j + "]" + abilityDataArray[modulePractice][j]);
                totI += abilityDataArray[modulePractice][j];
            } // for j
            registra("tot I " + i + " : " + totI);

            puntosTotalPr++;
            userScorePr = Math.ceil((puntosTotalPr * 100) / total);
            registra("addPoint: userScore: " + userScorePr);

            // var tot = Math.floor((totI * 100) / total);
            // registra("addPointPr Porcentaje " + tot);
            suspendObject.caliAbility[modulePractice] = userScorePr;
            // setScore();
        } //addPointPr

        //[module_]: Número del módulo de la evaluación
        //[total] : Total de preguntas de la evaluación
        function addPointEva(module_, total) {
            registra("addPointEva module: " + module_ + " -total: " + total);
            evaluaArray[(module_ - 1)]++;
            for (var i = 0; i < evaluaArray.length; i++) {
                registra("addPointEva evaluaArray[" + i + "] : " + evaluaArray[i]);
            } // for i
            totI = evaluaArray[(module_ - 1)];
            var tot = Math.floor((totI * 100) / total);
            registra("addPointEva Porcentaje " + tot);
            suspendObject.caliEvalua[(module_ - 1)] = tot;
            setScore();
        } //addPointEva

        //[module_]: Número del módulo de la evaluación
        //[practice] : Número de la práctica
        function resetScoreHTML(module_, practice) {
            registra("module_: " + module_ + " practice " + practice);
            if ((module_ == 0) && (practice == 0)) {
                puntos = 0;
                registra("resetScoreHTML index.html " + puntos);
            } // if((module_==0) && (practice==0)) {

            if ((module_ > 0) && (practice == 0)) {
                evaluaArray[(module_ - 1)] = 0;
                suspendObject.caliEvalua[(module_ - 1)] = 0;
            } //  module_>0
            if ((module_ > 0) && (practice > 0)) {
                registra("resetScoreHTML module " + module_ + " practice " + practice);
                puntosTotalPr = 0;
                for (var i = 0; i < abilityItemsArray.length; i++) {
                    if ((abilityItemsArray[i].module == module_) && (abilityItemsArray[i].number == practice)) {
                        registra("addPointPr - module: " + module_ + " -practice: " + practice + " found ... " + i);
                        modulePractice = i; // aquí se guarda el índice para saber el elemento fuera del ciclo
                        abilityDataArray[i] = new Array();
                        suspendObject.caliAbility[modulePractice] = 0;
                        break;
                    } // if 
                } // for i abilityItemsArray
            } //if ((module_>0) && (practice>0) )
        } //resetScoreHTML

        // function resetScoreHTML () {
        //  puntos=0;
        //   registra("module_: " + module_  +" practice " + practice);
        //   if (module_>0) {
        // 	  evaluaArray[(module_-1)] =0;
        // 	  suspendObject.caliEvalua[(module_-1)] = 0;
        // 	  registra("resetScoreHTML index.html " + puntos);	
        //   } //  module_>0
        //   if ((module_>0) && (practice>0) ) {
        //   	registra("resetScoreHTML module " + module_ + " practice " + practice);
        //   	 for (var i=0; i<abilityItemsArray.length;i++) {
        //    		if ( (abilityItemsArray[i].module==module_) && (abilityItemsArray[i].number==practice) ) {
        //    			registra("addPointPr - module: " + module_ + " -practice: " + practice + " found ... " + i);
        //    			modulePractice = i; // aquí se guarda el índice para saber el elemento fuera del ciclo
        //  					abilityDataArray[i]= new Array();
        //  					suspendObject.caliAbility[modulePractice] = 0;
        //    			break;
        //    		}// if 
        //    }// for i abilityItemsArray
        //   }//if ((module_>0) && (practice>0) )
        // }//resetScoreHTML

        // function resetPointPr(module_, practice, total) {
        // 	for (var i=0; i<abilityItemsArray.length;i++) {
        //    		if ( (abilityItemsArray[i].module==module_) && (abilityItemsArray[i].number==practice) ) {
        //    			registra("addPointPr - module: " + module_ + " -practice: " + practice + " found ... " + i);
        //    			modulePractice = i; // aquí se guarda el índice para saber el elemento fuera del ciclo
        //    				if (abilityDataArray[i].length==0) {  // Si es el primer punto registrado se genera todo el arreglo con ceros para poder sacar el total
        //    					registra("addPointPr - generate abilityDataArray - " + total);
        //    					abilityDataArray[i]= new Array(total);
        //    					for (var j=0; j<total; j++) {
        //    						abilityDataArray[i][j]=0;
        //    					} // for j < total
        //    				}//  if (abilityDataArray[i].length==0)
        //    				if (point <= abilityDataArray[i].length) {
        //    					registra("addPointPr - " + point + " - 1 ....");
        //    					abilityDataArray[i][point-1] = 1;  
        //    				} // if (point < abilityDataArray[i].length) {
        //    				// dentro del arreglo abilityDataArray[i][point] = 1 
        //    				// donde i es el módulo y práctica 
        //    				// y point es el punto obtenido
        //    				break;
        //    		}// if 
        //    }// for i abilityItemsArray
        // }// resetPointPr

        function setScore() {
            console.log('setScore', userScore);
            if (lmsConnected) { // Si hay scorm lmsConnected 
                if (scorm.version == "1.2") {
                    scorm.set("cmi.core.score.raw", userScore);
                } else if (scorm.version == "2004") {
                    scorm.set("cmi.score.raw", userScore);
                    scorm.set("cmi.score.scaled", (userScore / 10));
                } //2004
                suspendData = JSON.stringify(suspendObject);

                console.log('el suspend data es', suspendData);
                suspendData = suspendData.replace(/"/g, '|');
                console.log('el nuevo suspend data es', suspendData);

                scorm.set("cmi.suspend_data", suspendData);
                saveSCORM();
            } // lmsConnected
        } //setScore

        function getScore() {
            var hayCalificacion;
            if (lmsConnected) { // Si hay scorm lmsConnected 
                if (scorm.version == "1.2") {
                    hayCalificacion = scorm.get("cmi.core.score.raw");
                } else if (scorm.version == "2004") {
                    hayCalificacion = scorm.get("cmi.score.raw");
                    // scorm.get("cmi.score.scaled", (userScore / 10));
                } //2004
                if (!hayCalificacion) {
                    hayCalificacion = 0;
                }
                console.log('getScore', hayCalificacion);
                return hayCalificacion;
            } // lmsConnected
        } //getScore

        function saveSCORM() { //--jc--onUnload document event
            if (lmsConnected) { // Si hay scorm lmsConnected 
                suspendData = JSON.stringify(suspendObject);

                console.log('el suspend data es', suspendData);
                suspendData = suspendData.replace(/"/g, '|');
                console.log('el nuevo suspend data es', suspendData);

                scorm.set("cmi.suspend_data", suspendData);
                scorm.save(); //save all data that has already been sent 
            } // if lmsConnected
        } // saveSCORM

        function salir(site) {
            if (site != 'null') {
                window.close();
            } else {
                //alert("Opción disponible sólo con LMS"); 
            }
        } //salir

        function changeOver(obj) {
            obj.src = obj.src.replace(/0001/, "0002");
            $(obj).fadeIn(400);
        } //changeOver

        function changeOut(obj) {
            obj.src = obj.src.replace(/0002/, "0001");
            $(obj).fadeIn(400);
        } //changeOut

        function showMenu() {
            //registra("showMenu");
            //muteSlide();
            //changeTab(2);
            //changeTab(1);

            $("#menubar").fadeIn(300);
        } //showMenu

        function hideMenu() {
            //registra("hideMenu");
            //unmuteSlide();
            $("#menuIcon").fadeOut(150, function() {
                document.getElementById("menuIcon").src = "templateImages/menuIcon.png";
                document.getElementById("menuIcon").style.marginLeft = "0px";
                $("#menuIcon").fadeIn(150);
            });

            $("#menubar").fadeOut(300);
        } //hideMenu

        function over(num, obj) {
            imagesArray = new Array();
            imagesArray[0] = "templateImages/mapover.png";
            imagesArray[1] = "templateImages/birreteover.png";
            imagesArray[2] = "templateImages/glosarioover.png";
            imagesArray[3] = "templateImages/guiarapidaover.png";
            imagesArray[4] = "templateImages/salirover.png";
            obj.src = imagesArray[num];
        } //over

        function out(num, obj) {
            imagesArray = new Array();
            imagesArray[0] = "templateImages/map.png";
            imagesArray[1] = "templateImages/birrete.png";
            imagesArray[2] = "templateImages/glosario.png";
            imagesArray[3] = "templateImages/guiarapida.png";
            imagesArray[4] = "templateImages/salir.png";
            obj.src = imagesArray[num];
        } //out

        function exitWindow() {
            if (confirm(unescape("%BF") + "Realmente deseas salir de este curso?")) {
                parent.window.close();
            } //confirm
        } //exitWindow

        function prevSlide() {
            //registra("prevSlide - current " +current);
            if (current > 1) {
                current--;
                lock = false;
                loadSlide();
                //setMarcador();
            } //if current>1
        } //prevSlide

        function nextSlide() {
            if (current < (getTotalTopics())) {
                registra("nextSlide current: " + current);
                if (lock) {
                    registra("lock : " + lock);
                    registra("if : " + (lock) && (!topicsArray[current - 1].visited));
                } //lock

                if ((lock) && (!isVisited(current + 1))) {
                    // 	//alert("No se ha revisado todo el contenido de la pantalla.\nAsegúrate de revisar todo el contenido para poder continuar.");
                    // if((current==18)&& (! suspendObject.aprobo))  {
                    // 	registra("*** 1 current == 18 ! aprobo ***");
                    // 	$('#warningExamenModal').modal('show');
                    // 	return false;
                    // } // current =18 ! aprobo

                    // if ( (current==1) || (current==19)  ) {
                    // 		$('#warningVideoModal').modal('show');
                    // 		return false;
                    // 	}
                    // if ((current==18) && (! suspendObject.aprobo)) {
                    // 	return false;
                    // }//if ((current==18) && (! suspendObject.aprobo)) 

                    //  if (current !=18) {
                    // $('#warningModal').modal('show');
                    // return false;
                    // }// 
                } //lock

                if (!isVisited(current + 1)) {
                    // if ((current==18) && (! suspendObject.aprobo)) {
                    // 		registra("*** 2 current == 18 ! aprobo ***");
                    // 		$('#warningExamenModal').modal('show');

                    // 		return false;
                    // 	}//if ((current==18) && (! suspendObject.aprobo)) 
                } // ! isVisited(current+1)

                var flag = true;
                if (lmsConnected) { // solo si se está conectado al LMS

                    var tmpCurrent;
                    if (scorm.version == "1.2") {
                        tmpCurrent = parseInt(scorm.get("cmi.core.lesson_location"), 10);
                    } else if (scorm.version == "2004") {
                        tmpCurrent = parseInt(scorm.get("cmi.location"), 10);
                    } //else 2004 // if scorm.version 1.2 

                    console.log('tmpCurrent', tmpCurrent);

                    if (isNaN(tmpCurrent)) {
                        // Es la primera vez que el curso se abre.
                        firstTime = true;
                        current = 1;
                    } else {
                        current = tmpCurrent;
                    }
                    console.log('current', current);


                    console.log('suspendObject', suspendObject);
                    var len = suspendObject.M.length;
                    var tmpCont = 0;
                    var i = 0;
                    var j = 0;
                    for (i = 0; i < len; i++) {
                        for (j = 0; j < suspendObject.M[i].t.length; j++) {
                            if (tmpCont == current) {
                                break; // break for j
                            } // if tmpCont == current
                            console.log('suspendObject.M[i].t[j]._b', suspendObject.M[i].t[j]._b);
                            if (!(suspendObject.M[i].t[j]._b)) {
                                registra(" +++ NOT VISITED +++ " + tmpCont);
                                flag = false;
                            } else {
                                registra(tmpCont + " +++++ visited +++++ ");
                            } // else //if
                            tmpCont++;
                        } // for j
                        if (tmpCont == current) {
                            break; // break for i 
                        } // if tmpCont == current
                    } // for i
                    registra("flag: " + flag);
                    registra("j " + j);
                    registra("i " + i);
                    registra("suspendObject.M[" + i + "].t.length " + (suspendObject.M[i].t.length));
                    if (!flag) {
                        if (j == suspendObject.M[i].t.length) {
                            $("#warningModal").modal("show");
                            return false;
                        } // if
                    } // si no se han visitado todas las pantalla del módulo actual
                } else { // si no hay LMS se deshabilitan los candados
                    flag = true;
                } //else // if (lmsConnected)


                if (!flag) {
                    $("#warningModal").modal('show')
                    return false;
                } else {

                    current++;
                    // lock = false;
                    // setMarcador();
                    loadSlide(flag);
                }
            } //if current<getTotalTopics
        } //nextSlide

        function getVisitedObjectiveModule(num) {
            var tmpModule = new Array();
            if (lmsConnected) { // solo si se está conectado al LMS
                var len = suspendObject.M.length;
                var j = 0;
                if (num < len) {
                    for (j = 0; j < suspendObject.M[num].t.length; j++) {
                        if (!(suspendObject.M[num].t[j]._b)) {
                            tmpModule.push(false);
                        } else {
                            tmpModule.push(true);
                        } // else //if
                    } // for j
                } // if num < len
            } // if (lmsConnected)
            console.log("getVisitedObjectiveModule length: " + tmpModule.length);
            return tmpModule;
        } //getVisitedObjectiveModule


        function isVisited(num) {
            var flag = false;
            console.log("isVisited ...", num);
            registra("isVisited ...");
            if (lmsConnected) { // solo si se está conectado al LMS
                var len = suspendObject.M.length;
                tmpCont = 0;
                for (var i = 0; i < len; i++) {
                    for (var j = 0; j < suspendObject.M[i].t.length; j++) {
                        tmpCont++;
                        if ((suspendObject.M[i].t[j]._b) && (tmpCont == num)) {
                            registra("flag true j: " + j);
                            registra(" +++ VISITED +++");
                            flag = true;
                            return flag;
                        } else {
                            //registra("flag false: " + j);
                        } // else //if
                    } // for j
                } // for i
            } else { // si no hay LMS se deshabilitan los candados
                flag = true;
            } //else // if (lmsConnected)
            registra(" *** NOT VISITED ***");
            return flag;
        } // isVisited

        function goTo(num) {
            // num // validar
            closeSim();
            current = num;
            loadSlide();
        } // goTo

        function loadSlide(next) {


            if (next == undefined || next == null || next == "") {
                next = false;
            }

            console.log('loadSlide con next', next);

            // lock = false;


            // current = 0;
            // lock = false;
            if (lmsConnected) { // solo si se está conectado al LMS

                var suspendObject2 = suspendObject;
                var tmpSuspend2 = scorm.get("cmi.suspend_data"); //

                if ((tmpSuspend2.length == 0) || (tmpSuspend2 == undefined) || (tmpSuspend2 == "undefined")) {
                    console.log('no hay tmpSuspend');
                    lock = true;
                } else {
                    console.log('get el suspend data es', tmpSuspend2);
                    tmpSuspend2 = tmpSuspend2.replace(/\u007C/g, '"');
                    console.log('get el nuevo suspendData es', tmpSuspend2);

                    suspendObject2 = JSON.parse(tmpSuspend2);

                    var len = suspendObject2.M.length;
                    var tmpCont = 0;
                    var j = 0;
                    for (i = 0; i < len; i++) {
                        for (j = 0; j < suspendObject2.M[i].t.length; j++) {
                            if (tmpCont == (current)) {
                                current = tmpCont;
                                break;
                            }

                            // if (next && j > 0) {
                            //     lock = suspendObject2.M[i].t[(j - 1)]._b;
                            // } else {
                            lock = suspendObject2.M[i].t[j]._b;
                            // }
                            if (i == 0 && j == 0) {
                                lock = true;
                                // flag = true;
                            }
                            console.log('current', current, 'lock', lock);

                            tmpCont++;
                        }
                        if (tmpCont == current) {
                            break;
                        } // if tmpCont == current
                        // current += 1;

                    }

                }

                if (isNaN(current)) {
                    current = 0;
                }



                console.log('current', current);

            }

            console.log('loadSlide', current, lock, next);




            if (lmsConnected) {

                console.log("lock", lock, "pantallaDesbloqueada", pantallaDesbloqueada);
                if (!lock && !pantallaDesbloqueada) {
                    $("#warningModal").modal('show');
                    current--;
                    // return false;
                }

            }

            // si está el mapa abierto
            // var currentMap = 1;
            // if (conMapa) {
            //     currentMap = (current + 1);
            // } else {
            //     currentMap = current;
            // }

            console.log('audio1', audio1);
            if ((audio1 != null) && (audio1 != undefined)) {
                audio1.pause();
                audio1 = null;
            } // audio!=null

            console.log('hdocument', hdocument);
            if ((hdocument != null) && (hdocument != undefined)) {
                hdocument.pauseTimelineNamed('kTimelineDefaultIdentifier');
                hdocument = null;
            } // hdocument != null undefined

            setMarcador();
            var loading = "";
            var tmpLength = parseInt(topicsArray[current - 1].bookmark.split(" de ")[1].toLowerCase(), 10);
            console.log('tmpLength', tmpLength);
            var tmpCurrent = topicsArray[current - 1].bookmark.split(" de ")[0].toLowerCase()
            console.log('tmpCurrent', tmpCurrent);
            mainProgress((tmpCurrent * 100) / tmpLength);
            $("#divTitle").html(topicsArray[current - 1].fullName);
            //var loading='<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><img src="templateImages/loading.gif" class="img-responsive center-block" style=" vertical-align: middle;max-height: 500px;">';
            //document.getElementById("divContent").innerHTML = loading;
            //registra("loadSlide " + current + "-" + topicsArray[current-1].file);

            // document.getElementById("tmpLoad").innerHTML='<object type="text/html" onload="registra(\'onload\');loadAfterSlide();" data="' + topicsArray[current-1].file+ '" style="float:left;width:100%;height:630px;"></object>';

            //document.getElementById('iContent').src=topicsArray[current-1].file;
            $("#rowHeader").show();
            // closeMap();
            $("#divMapa").hide();
            // closeMap();
            conMapa = false;

            registra("divBack - with loading ... ");
            document.getElementById("divBack").style.display = "block";

            //document.getElementById("divContent").style.display="none";
            document.getElementById("divContent").style.overflow = "hidden";
            $("#divInferior").hide();

            // document.getElementById("divContent").innerHTML='<object type="text/html" data="' + topicsArray[current-1].file+ '" style="position:absolute;top:0;left:0;width:100%;height:'+height+'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;margin:0px;" id="objectContent"></object>';
            document.getElementById("divContent").innerHTML = '<object id="objectContent" type="text/html" data="' + topicsArray[current - 1].file + '" style="position:absolute;top:0;left:0;width:100%;height:' + laEscalaHeight + 'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;margin:0px;"></object>';
            //document.getElementById("objectContent").data=topicsArray[current-1].file;

            registra("navigator.navigator " + navigator.userAgent);
            if (navigator.userAgent.toLowerCase().indexOf("chrome") != -1) {
                document.getElementById("divBack").style.display = "none";
                document.getElementById("divContent").style.display = "block";
                document.getElementById("divSuperior").style.display = "block";
                document.getElementById("divInferior").style.display = "block";
            }
            document.getElementById("objectContent").addEventListener("load", loadedDocument, false);
            if ((navigator.platform.toLowerCase().indexOf("ipad") == -1) &&
                (navigator.platform.toLowerCase().indexOf("ipod") == -1) &&
                (navigator.platform.toLowerCase().indexOf("iphone") == -1)) {
                document.getElementById("divContent").style.display = "none";
            } // Not iPad


            //document.getElementById("divSuperior").style.display="none";
            //document.getElementById("divInferior").style.display="none";


            //document.getElementById("objectContent").addEventListener("loadeddata", loadedDataDoc, false);

            registra("First getElementsByTagName length: " + document.getElementById("objectContent").getElementsByTagName("body").length);
            registra("First setTimeout checkContentDocument...");
            //setTimeout("checkContentDocument()", 500);

            // $('#objectContent1')[0].addEventListener('load', function() {
            // 				registra("[0].addEventListener load ");    
            // }, true);


            //document.getElementById("objectContent").addEventListener("DOMContentLoaded", loadedDataDoc, false);
            //document.getElementById("objectContent").addEventListener("readystatechange", loadedDataDoc, false);
            // registra("archive: " + document.getElementById("objectContent").archive);
            // registra("contentDocument:" + document.getElementById("objectContent").contentDocument);
            // registra("ChildNodes: " + document.getElementById("objectContent").childNodes.length);
            // tmpDoc = document.getElementById("objectContent").contentDocument;
            // if (tmpDoc != null){
            // 	tmpDoc.addEventListener("load", loadedDataDoc, false);
            // }// if 
            //document.getElementById("objectContent").addEventListener("loadeddata", loadedData, false);

            // $.ajax({
            //       			dataType : "html",
            //       			async : false,
            //       			url : './content/cur_w10_portada/cur_w10_portada.html',
            //       			success : function(results) {
            //           		document.getElementById("divContent").innerHTML=results;
            //       			}
            //   			});

            //$("#divContent").ready(function () {
            //$(document).ready(function () {
            //$("#divContent").load(function(){
            registra("file: " + topicsArray[current - 1].file);
            registra("innerHTML: " + document.getElementById("divContent").innerHTML);
            //				 $("#divContent").load(topicsArray[current-1].file);
            //topicsArray[current-1].file
            // 	 $("#divContent").ready(function(){					
            // 	 	registra("load objectContent");
            // 	 document.getElementById("divContent").style.display="block";
            // 	 document.getElementById("divBack").style.display="none";

            // });

            //$("#divTitle").html(topicsArray[current-1].fullName);
            pantallaDesbloqueada = true;
            load = true;
            if (audio1 != null) {
                audio1.pause();
            } // audio!=null
            resetScoreHTML(); // resetea los scores de las prácticas y exámenes.
            // setTimeout("completaSCORM()", 500);
        } //loadSlide

        function loadSpecifiedSlide(fileName) {
            setMarcador();
            //var loading="";
            //var tmpLength=parseInt(topicsArray[current-1].bookmark.split(" de ")[1].toLowerCase(), 10);
            //var tmpCurrent = topicsArray[current-1].bookmark.split(" de ")[0].toLowerCase()
            //mainProgress((tmpCurrent*100)/tmpLength);
            ///$("#divTitle").html(topicsArray[current-1].fullName);
            document.getElementById("divBack").style.display = "block";
            document.getElementById("divContent").style.overflow = "hidden";
            $("#divInferior").hide();
            document.getElementById("divContent").innerHTML = '<object id="objectContent" type="text/html" data="' + fileName + '" style="position:absolute;top:0;left:0;width:100%;height:' + height + 'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;margin:0px;"></object>';

            document.getElementById("objectContent").addEventListener("load", loadedDocument, false);


            if ((navigator.platform.toLowerCase().indexOf("ipad") == -1) &&
                (navigator.platform.toLowerCase().indexOf("ipod") == -1) &&
                (navigator.platform.toLowerCase().indexOf("iphone") == -1)) {
                document.getElementById("divContent").style.display = "none";
            } // Not iPad
            resetScoreHTML(); // resetea los scores de las prácticas y exámenes.
            load = true;
            if (audio1 != null) {
                audio1.pause();
            } // audio!=null
            resetScoreHTML()
        } //loadSpecifiedSlide(fileName)

        function assessmentA() {
            loadSpecifiedSlide(assessmentAFile);
        } // assessmentA

        function assessmentNA() {
            loadSpecifiedSlide(assessmentNAFile);
        } // assessmentNA

        function loadAssessment() {
            current = getTotalTopics();
            loadSlide();
        } //loadAssessment

        function loadAssessment1() {
            setMarcador();
            var loading = "";
            $("#divTitle").html(finalAssessment[0].getAttribute("name"));
            document.getElementById("divBack").style.display = "block";
            document.getElementById("divContent").style.overflow = "hidden";

            document.getElementById("divContent").innerHTML = '<object type="text/html" data="' + finalAssessment[0].getAttribute("file") + '" style="position:absolute;top:0;left:0;width:100%;height:' + height + 'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;margin:0px;" id="objectContent"></object>';

            document.getElementById("objectContent").addEventListener("load", loadedDocument, false);
            if ((navigator.platform.toLowerCase().indexOf("ipad") == -1) &&
                (navigator.platform.toLowerCase().indexOf("ipod") == -1) &&
                (navigator.platform.toLowerCase().indexOf("iphone") == -1)) {
                document.getElementById("divContent").style.display = "none";
            } // Not iPad

            registra("First getElementsByTagName length: " + document.getElementById("objectContent").getElementsByTagName("body").length);
            registra("First setTimeout checkContentDocument...");

            registra("file: " + finalAssessment[0].getAttribute("file"));
            registra("innerHTML: " + document.getElementById("divContent").innerHTML);
            resetScoreHTML(); // resetea los scores de las prácticas y exámenes.

            load = true;
            if (audio1 != null) {
                audio1.pause();
            } // audio!=null
        } //loadAssessment1

        function checkContentDocument() {
            var tmpDoc = document.getElementById("objectContent").contentDocument;
            registra("getElementsByTagName length: " + document.getElementById("objectContent").childNodes.length);

            if (tmpDoc == null) {
                registra("setTimeout checkContentDocument");
                setTimeout("checkContentDocument()", 1000);
            } else {
                registra("tmpDoc != null - addEventListener... you Win");
                document.getElementById("divBack").style.display = "none";
                //document.getElementById("divContent").style.display="block";
                document.getElementById("objectContent").addEventListener("load", loadedDocument, false);
            } //else //if

        } // checkContentDocument

        function loadedData() {
            registra("loadedData...");
            document.getElementById("divBack").style.display = "none";
            //document.getElementById("divContent").style.display="block";
            registra("contentDocument:" + document.getElementById("objectContent").contentDocument);
        } // loadedData

        function loadedDataDoc() {
            registra("loadedDataDoc...");
            document.getElementById("divBack").style.display = "none";
            //document.getElementById("divContent").style.display="block";
        } // loadedDataDoc

        function loadedDocument() {
            registra("loadedDocument ... you win 2 ");
            document.getElementById("divBack").style.display = "none";
            document.getElementById("divContent").style.display = "block";
            document.getElementById("divSuperior").style.display = "block";
            document.getElementById("divInferior").style.display = "block";

        } //loadedDocument

        function loadAfterSlide() {
            // if (load) {

            // document.getElementById("divContent").innerHTML='<object type="text/html" data="' + topicsArray[current-1].file+ '" style="position:absolute;top:0;left:0;width:100%;height:'+height+'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;overflow:hidden;margin:0px;" id="objectContent"></object>';

            // document.getElementById("divContent").style.overflow="hidden";
            // load=false;
            // document.getElementById('iContent').src="about:blank";
            // resetScoreHTML (); // resetea los scores de las prácticas y exámenes.

            // $("#divTitle").html(topicsArray[current-1].fullName);

            // }//if load
        } //loadAfterSlide

        function outside() {
            //alert('outside');
        } //outside

        function docs(obj) {
            registra("length: " + obj.length);
        } //docs

        function showBlack() {
            hideMenu();
            document.body.style.background = "#343434";
            muteSlide();
            document.getElementById("divSim").style.height = (height + 39) + "px";
            document.getElementById("divSim").style.width = ($(window).width() - 35) + "px";
            document.getElementById("divSim").innerHTML = "";
            document.getElementById("divSim").style.display = "block";
            document.getElementById("divContent").style.display = "none";
            document.getElementById("divSuperior").style.display = "none";
            document.getElementById("divInferior").style.display = "none";

        } //showBlack

        function showGlossary() {
            hideMenu();
            document.body.style.background = "#343434";
            muteSlide();
            document.getElementById("divGlossary").style.height = (height + 39) + "px";
            document.getElementById("divGlossary").style.width = ($(window).width() - 35) + "px";
            document.getElementById("divContent").style.display = "none";
            document.getElementById("divSuperior").style.display = "none";
            document.getElementById("divInferior").style.display = "none";
            $("#divGlossary").fadeIn();
        } //showGlossary

        function closeGlossary() {
            unmuteSlide();
            //registra("fadeOut divGlossary*************************************");
            $("#divGlossary").fadeOut();
            document.body.style.background = "#FFFFFF";
            document.getElementById("divContent").style.display = "block";
            document.getElementById("divSuperior").style.display = "block";
            document.getElementById("divInferior").style.display = "block";

        } //closeGlossary

        function showGuia() {
            hideMenu();
            document.body.style.background = "#343434";
            muteSlide();
            //registra("showGuia: " + height);
            document.getElementById("divGuia").style.height = (height + 39) + "px";
            document.getElementById("divGuia").style.width = "100";
            document.getElementById("divContent").style.display = "none";
            document.getElementById("divSuperior").style.display = "none";
            document.getElementById("divInferior").style.display = "none";
            $("#divGuia").fadeIn();
        } //showGuia

        function closeGuia() {
            unmuteSlide();
            //registra("fadeOut divGuia*************************************");
            $("#divGuia").fadeOut();
            document.body.style.background = "#FFFFFF";
            document.getElementById("divContent").style.display = "block";
            document.getElementById("divInferior").style.display = "block";
            document.getElementById("divSuperior").style.display = "block";
        } //closeGuia

        function closeBlack() {
            unmuteSlide();
            closeSim();
        } //closeBlack

        function showMap() {
            registra("showMap ...");
            document.getElementById("divMapaContent").innerHTML = '<object type="text/html" data="content/bmv_mapa.html" style="position:absolute;top:0;left:0;width:100%;height:' + (height + 90) + 'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;margin:0px;" id="objectMapaContent"></object>';
            // document.body.style.background ="#343434";
            document.body.style.background = "#1d1f23";
            //registra("previous muteSlide...");
            muteSlide();
            //registra("showMapa: " + height);

            document.getElementById("divMapa").style.height = (height + 59) + "px";
            document.getElementById("divMapa").style.width = (screen.availWidth - 25) + "px";
            //document.getElementById("rowHeader").style.display="none";
            $("#rowHeader").hide();
            document.getElementById("divContent").style.display = "none";
            document.getElementById("divSuperior").style.display = "none";
            document.getElementById("divInferior").style.display = "none";

            $("#divMapa").fadeIn();
            registra("showMap Finish...");
            conMapa = true;
        } //showMap

        function closeMap() {
            //registra("closeMap");
            document.body.style.background = "#FFFFFF";
            //document.getElementById("rowHeader").style.display="inline";
            $("#rowHeader").show();
            document.getElementById("divContent").style.display = "block";
            document.getElementById("divSuperior").style.display = "block";
            document.getElementById("divInferior").style.display = "block";
            $("#divMapa").fadeOut();
            unmuteSlide();

            closeTem();
            //contextCirc.clearRect(0, 0, cCirc.width, cCirc.height);
            //contextDG1.clearRect(0, 0, cDG1.width, cDG1.height);
            //contextDG2.clearRect(0, 0, cDG2.width, cDG2.height);
            if (audio1 != null) {
                //audio1.play();
            } // audio!=null
            conMapa = false;
        } //closeMap

        var totalLock = 0;
        var lockArray = new Array();
        var lock = false;

        function setLock(num) {
            console.log("setLock num: " + num);
            pantallaDesbloqueada = false;
            console.log("pantallaDesbloqueada", pantallaDesbloqueada);
            totalLock = num;
            lockArray = new Array();
            for (a = 0; a < num; a++) {
                lockArray[a] = false;
            }
            console.log("lockArray", lockArray);

            lock = false;
        } //setLock

        function pushLock(pos, data) {
            data = data.toString();
            console.log("pushLock pos: " + pos + " - data: " + data, "totalLock", totalLock);

            if (lmsConnected) {

                // suspendObject.M[0].t[(current - 1)]._b = true;
                // suspendObject.M[0].t[(current)]._b = true;
                // lock = true;
            }

            pos--;
            if (pos < totalLock) {
                lockArray[pos] = data;
            }
            var tmpFlag = true;
            for (var i = 0; i < totalLock; i++) {
                // console.log("lockArray[i]:  [" + lockArray[i] + "]");
                if (!((lockArray[i] != "") && (lockArray[i] != "undefined") && (lockArray[i] != undefined))) {
                    tmpFlag = false;
                } // if

                // console.log("lockArray[i] == totalLock", lockArray[i], totalLock);
                // if (lockArray[i] == totalLock) {
                //     lock = true;
                //     pantallaDesbloqueada = true;
                //     console.log("pantallaDesbloqueada", pantallaDesbloqueada);
                //     tmpFlag = false;
                // }
            } // for var i
            if (tmpFlag) {
                // lock = false;
            } // if tmpFlag
            // console.log('lockArray', lockArray);
            // console.log("pushLock lock " + (lock).toString());

            function cuentaCandados() {
                console.log('cuentaCandados lockArray', lockArray);
                var bloq = lockArray.every(function(val) {
                    return val != false;
                });
                if (bloq) {
                    // console.log('todos los candados desblqueados', bloq);
                    lock = true;
                    pantallaDesbloqueada = true;
                    console.log("pantallaDesbloqueada", pantallaDesbloqueada);
                    tmpFlag = false;

                    suspendData = suspendData.replace(/"/g, '|');
                    console.log('el nuevo suspend data es', suspendData);
                    scorm.set("cmi.suspend_data", suspendData);
                    scorm.save();

                } else {
                    console.log('faltan candados por desbloquear');
                }
            }
            cuentaCandados();

        } //pushLock

        function showAyuda() {
            hideMenu();
            document.body.style.background = "#343434";
            muteSlide();
            document.getElementById("divAyuda").style.height = (height + 39) + "px";
            document.getElementById("divAyuda").style.width = (screen.availWidth - 35) + "px";
            document.getElementById("divContent").style.display = "none";
            document.getElementById("divSuperior").style.display = "none";
            document.getElementById("divInferior").style.display = "none";
            $("#divAyuda").fadeIn();
        } //showGlossary

        function closeAyuda() {
            unmuteSlide();
            //registra("fadeOut divAyuda*************************************");
            $("#divAyuda").fadeOut();
            document.body.style.background = "#FFFFFF";
            document.getElementById("divContent").style.display = "block";
            document.getElementById("divSuperior").style.display = "block";
            document.getElementById("divInferior").style.display = "block";
        } //closeAyuda

        function showSim(num) {
            var num = (typeof num !== 'undefined') ? num : 1; // valida la existencia del parámetro, de lo contrario asigna el valor 1 por default;

            document.body.style.background = "#343434";
            muteSlide();
            //alert("showSim");
            //registra('document.getElementById("divSim").style.height:' + document.getElementById("divSim").style.height);
            //registra('document.getElementById("divSim").style.width:' + document.getElementById("divSim").style.width);
            //document.getElementById('divSim').setAttribute("style","height:"+(screen.availHeight+0)+"px");
            //document.getElementById("divSim").style.height= (screen.availHeight+20) +"px";
            document.getElementById("divSim").style.height = (height + 39) + "px";
            document.getElementById("divSim").style.width = ($(window).width() - 35) + "px";
            //document.getElementById('divSim').setAttribute("style","width:"+($(window).width()-20)+"px");
            //registra('document.getElementById("divSim").style.height:' + document.getElementById("divSim").style.height);
            //registra('document.getElementById("divSim").style.width:' + document.getElementById("divSim").style.width);
            num--;
            var arraySims = topicsArray[current - 1].sim.split(";");
            var sim = arraySims[num];
            if (num < arraySims.length) {
                //registra(arraySims[num]);
                sim = arraySims[num];
            } //if num < arraySims
            document.getElementById("divSim").innerHTML = '<object type="text/html" data="' + sim + '" style="position:relative;width:' + ($(window).width() - 35) + 'px;height:' + (height + 39) + 'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;overflow:hidden;margin:auto;"></object>';
            document.getElementById("divSim").style.display = "block";
            document.getElementById("divContent").style.display = "none";
            document.getElementById("divSuperior").style.display = "none";
            document.getElementById("divInferior").style.display = "none";

            window.top.document.getElementById("scorm_content").style.background = "#343434";
        } //showSim

        function closeSim() {
            // registra("closeSim");
            document.body.style.background = "#FFFFFF";
            document.getElementById("divContent").style.display = "block";
            document.getElementById("divSuperior").style.display = "block";
            document.getElementById("divInferior").style.display = "block";
            document.getElementById("divSim").style.display = "none";
            //document.getElementById("divGuia").style.display="none";
            $("#divGuia").fadeOut();
            $("#divAyuda").fadeOut();
            document.getElementById("divGlossary").style.display = "none";
            // document.getElementById("divAyuda").style.display = "none";
            // document.getElementById("divGuia").style.display = "none";
            document.getElementById("divSim").innerHTML = "";
            userScore = 0;
            numPre = 0;
            unmuteSlide();

            window.top.document.getElementById("scorm_content").style.background = "#FFFFFF";
        } //closeSim

        function closeDiv() {
            closeSim();
        } //closeDiv

        function muteSlide() {
            registra("muteSlide...");
            if (audio1 != null) {
                registra("muteSlide - audio1.pause...");
                audio1.pause();
            } // audio!=null
            if (hdocument != null) {
                hdocument.pauseTimelineNamed('kTimelineDefaultIdentifier');
            } // hdocument!=null
        } //muteSlide


        function unmuteSlide() {

            registra("unmuteSlide..." + navigator.appVersion);
            registra("audio1 " + audio1);
            registra("hdocument " + hdocument);
            if ((navigator.appVersion.indexOf("Chrome") == -1) || (navigator.appVersion.indexOf("Edge") > -1)) {
                if ((audio1 != null) && (audio1 != undefined)) {
                    registra("unmuteSlide - audio1.pause...");
                    audio1.play();
                } // audio!=null
                if ((hdocument != null) && (hdocument != undefined)) {
                    registra("currentTimeInTimelineNamed kTimelineDefaultIdentifier: " + hdocument.currentTimeInTimelineNamed('kTimelineDefaultIdentifier'));
                    registra("durationForTimelineNamed kTimelineDefaultIdentifier: " + hdocument.durationForTimelineNamed('kTimelineDefaultIdentifier'));
                    hdocument.continueTimelineNamed('kTimelineDefaultIdentifier');
                } // hdocument!=null
            } // if Chrome
        } //unmuteSlide

        function setMarcador() {
            registra("setMarcador");
            if (lmsConnected) { // solo si se está conectado al LMS
                if (scorm.version == "1.2") {
                    res = scorm.data.set("cmi.core.lesson_location", (current));
                } else if (scorm.version == "2004") {
                    res = scorm.data.set("cmi.location", (current));
                } //if
                var tmpStr = topicsArray[current - 1].bookmark;
                $("#marcador").html(tmpStr);
                registra("#marcador: " + tmpStr);
                var indexI = topicsArray[current - 1].indexI;
                var indexJ = topicsArray[current - 1].indexJ;
                registra("indexI: " + indexI);
                registra("indexJ: " + indexJ);
                suspendObject.M[indexI].t[indexJ]._b = true;
                registra("setMarcador suspendObject: " + suspendObject.M[indexI].t[indexJ]._b);
                suspendData = JSON.stringify(suspendObject);

                console.log('el suspend data es', suspendData);
                suspendData = suspendData.replace(/"/g, '|');
                console.log('el nuevo suspend data es', suspendData);

                scorm.set("cmi.suspend_data", suspendData);
            } //if lmsConnected
        } //setMarcador

        function resizeDiv() {
            console.log("1. resizeDiv: " + height + "\ninnerHeight: " + window.innerHeight + "\nparent.innerHeight: " + window.parent.innerHeight + "\n");
            if (window.innerHeight > window.innerWidth) {
                //	alert("Por favor gira tu dispositivo horizontalmente.");
            } // Please use Landscape!
            height = ((window.parent.innerHeight - divSuperiorHeight) - divInferiorHeight) - 35;
            if (((navigator.userAgent.indexOf("Chrome") > -1) || (navigator.userAgent.indexOf("Edge") > -1)) && (navigator.platform.toLowerCase() == "win32")) {
                height -= 55;
            } // if 
            if ((navigator.platform.toLowerCase().indexOf("ipad") != -1) ||
                (navigator.platform.toLowerCase().indexOf("ipod") != -1) ||
                (navigator.platform.toLowerCase().indexOf("iphone") != -1)) {
                //$("#imgFullScreen").hide();
                document.getElementById("canvasGraph1").style.width = "530px";
                document.getElementById("canvasGraph1").width = "530";
            } // if ipad ipod iphone
            console.log("navigator.platform: " + navigator.platform + "\nnavigator.appName: " + navigator.appName + "\nnavigator.appCodeName: " + navigator.appCodeName + "\nnavigator.userAgent: " + navigator.userAgent + "\nnavigator.platform: " + navigator.platform);

            console.log("2. resizeDiv: " + height + "\ninnerHeight: " + window.innerHeight + "\nparent.innerHeight: " + window.parent.innerHeight);
            //	document.forms[0].inputData.value+="2. resizeDiv: " + height + "\ninnerHeight: " + window.innerHeight+ "\nparent.innerHeight: "  +  window.parent.innerHeight+"\n";
            //alert ("window.outerHeight: " +window.innerHeight + "\nheight:" + height);

            document.getElementById("divContent").style.height = laEscalaHeight + "px";
            document.getElementById("divBack").style.height = document.getElementById("divContent").style.height;
            //$("#divBack").hide();
            document.getElementById("objectContent").style.height = laEscalaHeight + 'px';
            document.getElementById("objectAyuda").style.height = (laEscalaHeight + divSuperiorHeight + divInferiorHeight) + 'px';
            document.getElementById("objectGuia").style.height = (laEscalaHeight + divSuperiorHeight + divInferiorHeight) + 'px';


            $('#modalBloq_int').css("-ms-transform", "scale(" + (scaleTemplate + .2) + "," + (scaleTemplate + .2) + ")");
            $('#modalBloq_int').css("-webkit-transform", "scale(" + (scaleTemplate + .2) + "," + (scaleTemplate + .2) + ")");
            $('#modalBloq_int').css("transform", "scale(" + (scaleTemplate + .2) + "," + (scaleTemplate + .2) + ")");


            // $("#divSuperior").show();
            // $("#divContent").show();
            // $("#divInferior").show();
        } //resizeDiv_resizesable

        function resizeDiv_2_Size() {
            registra("resizeDiv screen.availHeight: " + screen.availHeight);
            registra("resizeDiv maxHeight: " + maxHeight);
            if ((screen.availHeight < maxHeight) && ((navigator.platform.toLowerCase().indexOf("ipad") == -1) &&
                    (navigator.platform.toLowerCase().indexOf("ipod") == -1) &&
                    (navigator.platform.toLowerCase().indexOf("iphone") == -1))) {
                //height=460;
                height = 555;
                document.getElementById("divContent").style.height = height + "px";
            } else if ((screen.availHeight > maxHeight) && ((navigator.platform.toLowerCase().indexOf("ipad") == -1) &&
                    (navigator.platform.toLowerCase().indexOf("ipod") == -1) &&
                    (navigator.platform.toLowerCase().indexOf("iphone") == -1))) {
                //--jc
                //height=680;
                //height=768;
                height = 667;
                width = 1200;
                document.getElementById("divContent").style.height = height + "px";
                document.getElementById("divContent").style.width = width + "px";
                document.getElementById("divSuperior").style.width = width + "px";
                //document.getElementById("divSuperiorPadre").style.width=width+"px";
                document.getElementById("divInferior").style.width = width + "px";
                registra("resizeDiv height: " + height);
            } else if ((screen.availHeight > 800) && ((navigator.platform.toLowerCase().indexOf("ipad") > -1) ||
                    (navigator.platform.toLowerCase().indexOf("ipod") > -1) ||
                    (navigator.platform.toLowerCase().indexOf("iphone") > -1))) {
                height = 680;
                document.getElementById("divContent").style.height = height + "px";
                document.getElementById("divBack").style.height = height + "px";
                //alert("height: " + height);
            } // else // if maxHeight
            document.getElementById("divBack").style.height = document.getElementById("divContent").style.height;
            $("#divBack").hide();
            $("#divSuperior").show();
            $("#divContent").show();
            $("#divInferior").show();
            document.getElementById("divAyuda").style.height = height + "px";
            document.getElementById("divGuia").style.height = height + "px";
            registra("***///*** end resizeDiv height: " + height);

            // registra("divContent style height : " + $("#divContent").height());
            // registra("divSuperior style height : " + $("#divSuperior").height() + "- " + $("#divSuperior").innerHeight() + "- " + $("#divSuperior").outerHeight() + "- " + $("#divSuperior").outerHeight(true));
            // registra("divInferior style height : " + $("#divInferior").height() + "- " + $("#divInferior").innerHeight()+ "- " + $("#divInferior").outerHeight()+ "- " + $("#divInferior").outerHeight());
            // registra("total 3: " + ( parseInt($("#divContent").height(),10) +
            // 	parseInt($("#divSuperior").height(),10) + 
            // 	parseInt($("#divInferior").height(),10) ) );
        } //resizeDiv_2_Size


        function setScale() {
            sourceHeigth = 738;
            sourceWidth = 1200;
            var contentHeigth = $(window).height();
            var contentWidth = $(window).width();
            var _scaleX = contentWidth / sourceWidth;
            var _scaleY = contentHeigth / sourceHeigth;
            console.log("scaleTemplate: " + scaleTemplate + "\n_scaleX: " + _scaleX + "\n_scaleY: " + _scaleY);

            if (_scaleX <= _scaleY) {
                scaleTemplate = _scaleX;
            } else {
                scaleTemplate = _scaleY;
            }
            if (scaleTemplate >= 1) {
                scaleTemplate = 1;
            }
        }


        /// Objects for XML parameters

        //  Valores por default para el gráfico principal
        // graphMainObject(graphColor, graphBackgroundColor, textColor, textBackgroundColor, centralCircleColor, messages) {
        // graphMainObject(graphColor, graphBackgroundColor, textColor, textBackgroundColor, centralCircleColor, lineWidth, backgroundLineWidth, messages) {

        var graphMain = new graphMainObject("#00bad0", "#222736", "#FFFFFF", "#333333", "#00bad0", 9, 20, null);
        //  Valores por default para los gráficos de los módulos
        //graphModulesObject (progressColor, progressBackgroundColor, progressSelectedBackgroundColor, squareBackgroundColor, squareSelectedBackgroundColor, textColor)
        //graphModulesObject (progressColor, progressBackgroundColor, progressSelectedBackgroundColor, squareBackgroundColor, squareSelectedBackgroundColor, textColor)
        var graphModules = new graphModulesObject("#61AAEB", "#3F4456", "#61AAEB", "#1D1F23", "#1D1F23", "#9FAABC");
        //  Valores por default para los elementos de los módulos	
        //contentModules = new contentModulesObject (textColor, lineSquareColor, squareColor, squareSelectedColor);
        var contentModules = new contentModulesObject("#9FAABC", "#ACACAD", "#2E3135", "#46ADF9");
        //graphPerformanceObject(messages, levels)
        var graphPerformance = new graphPerformanceObject(null, null);
        var abilityItemsArray = new Array();
        var abilityDataArray = new Array();
        var evaluaArray = new Array();
        var evaluaArrayCont = 0;
        var starsArray = new Array();
        var finalAssessment = "";
        var assessmentNAFile = "";
        var assessmentAFile = "";
        var logoText = "templateImages/logoText.png";

        //// Load All XML Data - jc
        $(document).ready(function() {
            registra("ready...");
            $.ajax({
                type: "GET",
                url: "./index.xml",
                dataType: "xml",
                success: function(xml) {
                    var xmlDoc = $.parseXML(xml);
                    var $xml = $(xmlDoc);
                    var index = xml.getElementsByTagName("index");
                    var titulo = "";
                    if (index[0].hasAttribute("course")) {
                        titulo = index[0].getAttribute("course");
                        registra("hasAttribute course " + titulo);
                    } // hasAttribute course

                    // if (index[0].hasAttribute("logo")) {
                    // if (index[0].getAttribute("logo").length > 0) {
                    // document.getElementById("imgLogo").src = index[0].getAttribute("logo");
                    // registra(index[0].getAttribute("logo"));
                    // } // if index[0].getAttribute("logo").length>0
                    // } // if index[0].hasAttribute("logo")

                    var totalTopics = 0;
                    var m = xml.getElementsByTagName("module");
                    // suspendObject = new suspendObj(m.length - 1);
                    var assessment = xml.getElementsByTagName("assessment");

                    // finalAssessment = assessment[0].getElementsByTagName("item");
                    // registra("finalAssessment : " + finalAssessment[0].getAttribute("file") + " - " + finalAssessment[0].getAttribute("name"));

                    var _graphMain = xml.getElementsByTagName("graphMain"); // parámetros para el gráfico principal del mapa de aprendizaje
                    var _graphModules = xml.getElementsByTagName("graphModules"); // parámetros para los módulos
                    var _contentModules = xml.getElementsByTagName("contentModules"); // parámetros para el contenido de cada módulo
                    var _graphPerformance = xml.getElementsByTagName("graphPerformance"); // parámetros para la gráfica de rendimiento de cada módulo
                    var _abilityItems = xml.getElementsByTagName("ability"); // etiqueta principal que agrupa los items de la disponibilidad



                    // <graphMain graphColor="#" graphBackgroundColor="#" textColor="#">
                    // 		<message text="0% a 30%... " min="0" max="30" />
                    // 		<message text="31% a 50%... " min="31" max="50" />
                    // 		<message text="51% a 65%... " min="51" max="65" />
                    // 		<message text="66% a 85%... " min="66" max="85" />
                    // 		<message text="86% a 100%... " min="86" max="100" />
                    // 	</graphMain>

                    // 	<graphModules progressColor="#" progressBackgroundColor="#" progressSelectedBackgroundColor="#" squareBackgroundColor="#" squareSelectedBackgroundColor="#" textColor="#" /> 
                    // 	<contentModules textColor="#" lineSquareColor="#" squareColor="#" squareSelectedColor="#"  />
                    var contador = 0;
                    // suspendObj (numModules, numAbilities);
                    suspendObject = new suspendObj(m.length - 1, abilityItemsArray.length);
                    for (var i = 0; i < m.length; i++) {
                        //$("#topics" ).append('<li>' +m[i].getAttribute("name")+ ' - ' +m[i].getAttribute("number"));
                        var t = m[i].getElementsByTagName("topic");
                        //$("#topics" ).append('<ul>');
                        suspendObject.M[i] = new mo(t.length);
                        var tArray = new Array();
                        for (var j = 0; j < t.length; j++) {
                            contador++;
                            //function topic(name, fullName, file, audio, audioFile, sim, bookmark, indexI, indexJ){
                            tArray[j] = new topic(t[j].getAttribute("name"), m[i].getAttribute("name") + " | " + t[j].getAttribute("name"), t[j].getAttribute("file"), t[j].getAttribute("audio"), t[j].getAttribute("audiofile"), t[j].getAttribute("sim"), contador, i, j);
                            if (trim(t[j].getAttribute("name").toUpperCase()) == "EVALUACIÓN") {
                                evaluaArrayCont++;
                                registra("**** EVALUACIÓN " + evaluaArrayCont);
                            } // if Evaluación
                            //	$("#topics" ).append('<li>' +t[j].getAttribute("name")+ ' - ' +t[j].getAttribute("file")+ '</li>');
                            //registra(topics[i].getAttribute("name"));
                        } //for j topics raw
                        for (j = 0; j < t.length; j++) {
                            suspendObject.M[i].t[j] = new na(j, false);
                            topicsArray[totalTopics] = new topic(t[j].getAttribute("name"), m[i].getAttribute("name") + " | " + t[j].getAttribute("name"), t[j].getAttribute("file"), t[j].getAttribute("audio"), t[j].getAttribute("audiofile"), t[j].getAttribute("sim"), ((j + 1) + " de " + tArray.length), i, j);
                            totalTopics++;
                        } //for j topics in module

                        //$("#topics" ).append('</ul</li>');
                        //function module(name, number, image, topics){
                        modulesArray[i] = new module(m[i].getAttribute("name"), m[i].getAttribute("number"), m[i].getAttribute("image"), tArray);
                        //registra(modulesArray[i].getModule());
                    } //for i modules
                    suspendObject.setTotalCaliEvalua(evaluaArrayCont);
                    evaluaArray = new Array(evaluaArrayCont);
                    for (var i = 0; i < evaluaArrayCont; i++) {
                        evaluaArray[i] = 0;
                    } // for i
                    // Se agrega la evaluación Final al arreglo de temas
                    totalTopics++;

                    //document.getElementById("divContent").innerHTML='<object type="text/html" data="botonera.html" style="float:left;width:100%;height:500px;"></object>';
                    //registra("topicsArray " + topicsArray.length);
                    //registra("stringify suspendObject: ");
                    //registra(JSON.stringify(suspendObject));
                    var tmpSD = "none";
                    try {
                        tmpSD = JSON.stringify(suspendObject);
                    } catch (err) {
                        registra("JSON.stringify: " + err.message);
                    } //catch
                    registra("suspendObject stringify: " + tmpSD);
                    current = 1;
                    if (lmsConnected) {
                        var tmpCurrent;
                        if (scorm.version == "1.2") {
                            tmpCurrent = parseInt(scorm.get("cmi.core.lesson_location"), 10);
                        } else if (scorm.version == "2004") {
                            tmpCurrent = parseInt(scorm.get("cmi.location"), 10);
                        } //else 2004 // if scorm.version 1.2 

                        if (isNaN(tmpCurrent)) {
                            // Es la primera vez que el curso se abre.
                            firstTime = true;
                            current = 1;
                        } else {
                            // current = tmpCurrent;
                            // current = tmpCurrent;
                            current = parseInt(scorm.get("cmi.core.lesson_location"), 10);
                        } // if isNaN
                        registra("Current: " + current);
                        tmpSuspend = scorm.get("cmi.suspend_data"); // cmi.suspend_data 1.2 y 2004
                        //registra("tmpSuspend: " + tmpSuspend);
                        //registra("tmpSuspend.length: " + tmpSuspend.length);
                        //registra("tmpSuspend==undefined: " + tmpSuspend==undefined);
                        //registra("suspendObject: " + suspendObject);
                        ///// ejecutar esto en el ready para que el objeto suspendObject se ecnuentre creado.
                        if ((tmpSuspend.length == 0) || (tmpSuspend == undefined) || (tmpSuspend == "undefined")) {

                            console.log('el suspend data es', tmpSuspend);
                            tmpSuspend = tmpSuspend.replace(/"/g, '|');
                            console.log('el nuevo suspend data es', tmpSuspend);

                            // scorm.set("cmi.suspend_data", tmpSD); // crea el nuevo objeto en 
                            scorm.set("cmi.suspend_data", tmpSuspend); // crea el nuevo objeto en 
                            //pipwerks.SCORM.data.set("cmi.suspend_data", JSON.stringify(suspendObject)); // crea el nuevo objeto en suspend_data
                        } else {
                            try {
                                console.log('get el suspend data es', tmpSuspend);
                                tmpSuspend = tmpSuspend.replace(/\u007C/g, '"');
                                console.log('get el nuevo suspendData es', tmpSuspend);

                                suspendData = JSON.stringify(tmpSuspend);
                                suspendObject = JSON.parse(tmpSuspend);

                                //registra("try tmpSuspend: " + tmpSuspend);
                                //registra("suspendObject.M[0].t[0]._t:" + suspendObject.M[0].t[0]._t);
                            } catch (err) {
                                registra("JSON.parse error: " + err.message);
                                suspendData = suspendObject;
                            } //catch
                        } //else // if tmpSuspend.length == 0
                    } // if lmsConnected 

                    setScale();
                    loadSlide();
                    resizeDiv();

                    //setMarcador();
                    if (index[0].hasAttribute("guide")) {
                        var guide = index[0].getAttribute("guide");
                        document.getElementById("subDivGuia").innerHTML = '<object id="objectGuia" type="text/html" data="' + guide + '" style="position:absolute;top:0;left:0;width:100%;height:' + (laEscalaHeight + divSuperiorHeight + divInferiorHeight) + 'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;overflow:hidden;margin:0px;"></object>';
                        registra("hasAttribute guide " + guide);
                    } // if hasAttribute guide
                    if (index[0].hasAttribute("help")) {
                        var help = index[0].getAttribute("help");
                        document.getElementById("subDivAyuda").innerHTML = '<object id="objectAyuda" type="text/html" data="' + help + '" style="position:absolute;top:0;left:0;width:100%;height:' + (laEscalaHeight + divSuperiorHeight + divInferiorHeight) + 'px;overflow:hidden;overflow-y:hidden;overflow-x:hidden;padding:0px;overflow:hidden;margin:0px;"></object>';
                        registra("hasAttribute help  " + help);
                    } // if hasAttribute help
                } // success
            }); //ajax index

        }); //ready



        $(window).resize(function() {
            laEscalaWidth = $(window).width();
            console.log('laEscalaWidth', laEscalaWidth);
            laEscalaHeight = ($(window).height() - divSuperiorHeight - divInferiorHeight);
            console.log('laEscalaHeight', laEscalaHeight);

            setScale();
            resizeDiv();
            // loadSlide();


            $("#divMapa").css({
                "width": laEscalaHeight / 8 + "%",
                "max-width": "95%"
            })
            // $("#divGuia, #divAyuda").css({
            //     "width": "100%",
            //     "max-width": "100%" 
            // })
            // $("#canvasCirc").css({
            //     "width": "80%"
            // })
            $("#canvasGraph1").css({
                "width": "100%"
            })
            // $("#divTem").css({
            //     "font-size": "100%"
            // })
            if (laEscalaWidth <= 1200) {
                $(".temasTitulo").css({
                    "font-size": (laEscalaWidth / 8) + "%"
                })
                $(".temasTema").css({
                    "font-size": (laEscalaWidth / 13) + "%"
                })
                $(".canvasCheck").css({
                    "width": (laEscalaWidth / 70) + "px"
                })
            }
            $("#canvasMod01, #canvasMod02, #canvasMod03, #canvasMod04, #canvasMod05, #canvasExamenFinal").css({
                "max-width": "120%",
                // "margin-left": "5%",
                // "margin-right": "5%"
            })

            if (tab == 1) {
                $("#tooltip").css({
                    "padding": "10px",
                    "font-size": (laEscalaWidth / 10) + "%",
                    "max-width": (laEscalaWidth / 20) + "%",
                    "max-height": (laEscalaWidth / 30) + "%",
                    "background-size": "100%"
                })
            } else if (tab == 2) {
                $("#tooltip").css({
                    "padding": "10px",
                    "font-size": (laEscalaWidth / 14) + "%",
                    "max-width": (laEscalaWidth / 20) + "%",
                    "max-height": (laEscalaWidth / 30) + "%",
                    "background-size": "100%"
                })
            }

        });



        //----------------- Object suspend_data
        var suspendObject;
        var conMapa = false;

        function suspendObj(numModules, numAbilities) {
            this.caliFinal = 0; /// valor de la calificación final
            this.caliDragDrop = 0;
            this.caliAbility = new Array(numAbilities); /// elemento que almacena las calificaciones de las prácticas de cada módulo
            for (var i = 0; i < numAbilities; i++) {
                this.caliAbility[i] = 0;
            } // for i
            this.caliEvalua = new Array(); /// elemento que almacena las calificaciones de las evaluaciones de cada módulo
            this.M = new Array(numModules);
            this.setTotalCaliEvalua = setTotalCaliEvalua;
        } //suspendObj

        function setTotalCaliEvalua(tot) {
            this.caliEvalua = new Array(tot);
            for (var i = 0; i < tot; i++) {
                this.caliEvalua[i] = 0;
            } // for i
        } // setTotalCaliEvalua

        function caliData(mod, num, cali) {
            this.mod = mod; /// número del módulo
            this.num = num; /// número dentro del módulo
            this.cali = cali; /// calificación del elemento
        } // caliData

        function mo(numTopics) {
            this.t = new Array(numTopics);
        } //m

        function na(_t, _b) {
            this._t = _t;
            this._b = _b;
        } //t
        //----------------- Objects Index
        var modulesArray = new Array();
        var topicsArray = new Array();

        function module(name, number, image, topics) {
            this.name = name;
            this.number = number;
            this.image = image;
            this.topics = topics; // array
            this.getModule = getModule;
            //this.getTotalTopics = getTotalTopics;
        } //module constructor

        function topic(name, fullName, file, audio, audioFile, sim, bookmark, indexI, indexJ) {
            this.name = name;
            this.fullName = fullName;
            this.file = file;
            this.audio = audio;
            this.audioFile = audioFile;
            this.sim = sim;
            this.bookmark = bookmark;
            this.indexI = indexI;
            this.indexJ = indexJ;
            this.getTopic = getTopic;
        } //topic constructor


        // function topic(name, fullName, file, audio, audioFile, sim, bookmark){
        // 	this.name = name;
        // 	this.fullName = fullName;
        // 	this.file = file;
        // 	this.audio = audio;
        // 	this.audioFile = audioFile;
        // 	this.sim = sim;
        // 	this.bookmark = bookmark;
        // 	this.getTopic = getTopic;
        // }//topic constructor

        function getModule() {
            var content = "";
            for (i = 0; i < this.topics.length; i++) {
                content += this.topics[i].getTopic();
            } //for i topics
            return "Module: " + this.name + "-" + this.number + "-" + this.image + content;
        } //getModule

        function getTopic() {
            return "Topic: " + this.name + " - " + this.fullName + " - " + this.file + " - " + this.audio + " - " + this.audioFile + " - " + this.sim + "\n";
        } //getTopic

        function getTotalTopics() {
            var total = 0;
            for (var i = 0; i < modulesArray.length; i++) {
                total += modulesArray[i].topics.length;
            } //for i
            //registra("getTotalTopics(): " + total);
            return (total + 1);
        } //getTotalTopics

        var gArray = new Array();
        var lastLI = null;

        function gloss(term, definition, image) {
            this.term = term;
            this.definition = definition;
            this.image = image;
            this.getDefHTML = getDefHTML;
            this.getImageHTML = getImageHTML;
        } // obj gloss

        function getDefHTML() {
            return this.definition.replace(/\[/g, "<").replace(/\]/g, ">");
        } // getDefHTML

        function getImageHTML() {

            return "<img src='" + this.image + "' style='margin:auto;' class='img-responsive'/>";
        } //getImageHTML

        function goToDef(i) {
            document.getElementById("divdef").innerHTML = "<b>" + gArray[i].term + "</b><br/><br/>" + gArray[i].getDefHTML() + "<br/><br/>" + gArray[i].getImageHTML();
        } //goToDef

        function setLastLI(li) {
            lastLI = li;
        } //setLastLI

        function changeBold(t) {
            $(t).removeClass("ligloss");
            $(t).addClass("liglossBold");
            //t.style="font-weight:bold";
            if (lastLI != null) {
                //$(lastLI).css("font-weight", "normal");
                //lastLI.style="font-weight:normal";
                $(lastLI).removeClass("liglossBold");
                $(lastLI).addClass("ligloss");
            } //if lastLI !=null
            setLastLI(t);
        } //changeBold
        registra("window height: " + $(window).height() + "\n" +
            "document height : " + $(document).height() + "\n" +
            "window width: " + $(window).width() + "\n" +
            "document width: " + $(document).width() + "\n" +
            "window innerWidth: " + window.innerWidth + "\n" +
            "window.innerHeight: " + window.innerHeight + "\n" +
            "screen height: " + screen.height + "\n" +
            "screen width: " + screen.width + "\n" +
            "screen availWidth : " + $(window).width() + "\n" +
            "screen availHeight : " + $(window).height() + "\n" +
            "screen colorDepth: " + screen.colorDepth + "\n" +
            "screen pixelDepth: " + screen.pixelDepth + "\n" +
            "navigator appCodeName: " + navigator.appCodeName + "\n" +
            "navigator appName: " + navigator.appName + "\n" +
            "navigator appVersion: " + navigator.appVersion + "\n" +
            "navigator platform: " + navigator.platform + "\n" +
            "navigator userAgent: " + navigator.userAgent);

        function graphModulesObject(progressColor, progressBackgroundColor, progressSelectedBackgroundColor, squareBackgroundColor, squareSelectedBackgroundColor, textColor) {
            this.progressColor = progressColor;
            this.progressBackgroundColor = progressBackgroundColor;
            this.progressSelectedBackgroundColor = progressSelectedBackgroundColor;
            this.squareBackgroundColor = squareBackgroundColor;
            this.squareSelectedBackgroundColor = squareSelectedBackgroundColor;
            this.textColor = textColor;
        } // graphModulesObject

        function contentModulesObject(textColor, lineSquareColor, squareColor, squareSelectedColor) {
            this.textColor = textColor;
            this.lineSquareColor = lineSquareColor;
            this.squareColor = squareColor;
            this.squareSelectedColor = squareSelectedColor;
        } // contentModulesObject

        function graphMainObject(graphColor, graphBackgroundColor, textColor, textBackgroundColor, centralCircleColor, lineWidth, backgroundLineWidth, messages) {
            this.graphColor = graphColor;
            this.graphBackgroundColor = graphBackgroundColor;
            this.textColor = textColor;
            this.textBackgroundColor = textBackgroundColor;
            this.centralCircleColor = centralCircleColor;
            this.lineWidth = lineWidth;
            this.backgroundLineWidth = backgroundLineWidth;
            this.messages = messages; // array messages
        } // graphMainObject

        function msgs(msg, min, max) {
            this.msg = msg;
            this.min = min;
            this.max = max;
        } // msgs

        function graphPerformanceObject(messages, levels) {
            this.messages = messages; // arreglo de mensajes
            this.levels = levels; // arreglo de niveles
        } // graphPerformanceObject

        function messagePerformanceObject(title, _module) {
            this.title = title;
            this._module = _module;
        } // messagePerformanceObject

        function levelPerformanceObject(min, max, text) {
            this.min = min;
            this.max = max;
            this.text = text;
        } //levelPerformanceObject

        function abilityItemObject(module, text, number, messages) { // se debe crear un arreglo de abilityItemObject
            this.module = module; // módulo
            this.text = text.replace(/\\n/g, ' - '); // texto de cada elemento
            registra("abilityItemObject text: " + text);
            registra("abilityItemObject text: " + this.text);
            this.number = number // número de orden
            this.messages = messages; // arreglo de mensajes de cada elemento
        } //abilityItemObject

        function messageItemObject(star, text) {
            this.star = star;
            this.text = text;
        } // messageItemObject

        function starObject(number, min, max, text) {
            this.number = number;
            this.min = min;
            this.max = max;
            this.text = text;
        } // starObject
        //<!-- ==============================================Circle ================================================-->

        var maxCirc = 0; // porcentaje de avance de curso global // showMap realiza el conteo real
        var modulesArrayPercentage = new Array(); // porcentaje de avance por módulo // showMap realiza el conteo real
        var currentCirc = 0;
        var increment = 5;
        var seconds = 3; // 1000 un segundo 

        var cCirc = document.getElementById("canvasCirc");
        // var contextCirc = cCirc.getContext("2d");

        function draw1() {
            contextCirc.beginPath();
            contextCirc.strokeStyle = graphMain.graphBackgroundColor; //"#222736";
            contextCirc.lineWidth = 28;
            contextCirc.arc(150, 150, 104, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false); //full circle
            contextCirc.stroke();
            contextCirc.closePath();
            if (currentCirc < maxCirc) {
                setTimeout('fillCircle1()', seconds);
            } // currentCirc<limit
        } // draw1

        function fillCircle1() {
            contextCirc.clearRect(0, 0, cCirc.width, cCirc.height);
            contextCirc.beginPath();
            contextCirc.strokeStyle = graphMain.graphBackgroundColor; //"#222736";
            contextCirc.lineWidth = 32;
            contextCirc.arc(150, 150, 104, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false); //full circle
            contextCirc.stroke();
            contextCirc.closePath();
            contextCirc.beginPath();
            contextCirc.strokeStyle = graphMain.graphBackgroundColor; // "#222736";
            contextCirc.fillStyle = graphMain.graphBackgroundColor; //"#222736";
            contextCirc.lineWidth = 5;
            contextCirc.arc(150, 150, 70, 0, (Math.PI / 180) * 360, false);
            contextCirc.stroke();
            contextCirc.fill();
            contextCirc.closePath();
            contextCirc.beginPath();
            currentCirc += increment;
            contextCirc.font = "bold 59pt RobotoRegular";
            contextCirc.fillStyle = graphMain.textColor; // "#FFFFFF";
            var tmpCurrent = ("0" + currentCirc);
            tmpCurrent = tmpCurrent.substring(tmpCurrent.length - 2, tmpCurrent.length)
            if (currentCirc == 100) {
                contextCirc.font = "bold 48pt RobotoRegular";
                contextCirc.fillText(currentCirc, 81, 170);
            } else {
                contextCirc.fillText(tmpCurrent, 95, 175);
            } // currentCirc == 100
            contextCirc.font = "bold 20pt RobotoRegular";
            contextCirc.fillStyle = graphMain.textColor; //"#FFFFFF";
            contextCirc.fillText("%", 193, 172);
            var limit = 270 + ((90 * currentCirc) / 25);
            contextCirc.strokeStyle = graphMain.graphColor; //"#487FD7";
            contextCirc.lineWidth = 15;
            contextCirc.arc(150, 150, 112, getRadians(270), getRadians(limit), false);
            //registra(currentCirc +": " + limit);
            contextCirc.stroke();
            contextCirc.closePath();
            if (currentCirc < maxCirc) {
                setTimeout('fillCircle1()', seconds);
            } else {
                for (var i = 0; i < graphMain.messages.length; i++) {
                    registra("");
                    if ((currentCirc >= graphMain.messages[i].min) && (currentCirc <= graphMain.messages[i].max)) {
                        $("#graphSubText").html(graphMain.messages[i].msg); //--jc		
                        break;
                    } // if 
                } // for i
                currentCirc = 0;
                //document.forms[0].maxCirc.focus();
            } // currentCirc<maxCirc
        } // fillCircle1

        function getRadians(dgrs) {
            var degrees = (Math.PI / 180) * dgrs;
            return degrees;
        } // getRadians
        //<!-- ==================== graph1 ==================================== -->
        var cDG1 = document.getElementById("canvasGraph1");
        // cDG1.addEventListener("click", canvasClick, false);
        // var contextDG1 = cDG1.getContext("2d");
        var circle;
        var circles = new Array();
        var stepW; // = parseInt(cDG1.width / 4, 10);
        var stepH; // = parseInt(cDG1.height /5, 10);
        var clicked = false;
        var contextDG1Data; // variable para almacenar una imagen del context
        var coordsY2 = [40, 65, 40, 92, 110];
        var coordsY = [0, 85, 45, 50, 15]; // coordenadas de la gráfica [desempeño por módulo] [Tu desarrollo de habilidades en el curso]
        var linedash;
        // linedash = contextDG1.getLineDash();
        var cols = coordsY.length;
        var rows = 5;
        var previousSelectedCircle;
        var tab = 1;

        function changeTab(num) {
            tab = num;
            $("#tab01").css("background-color", "#292b31");
            $("#tab02").css("background-color", "#292b31");
            $("#tooltip").hide();
            contextDG1.clearRect(0, 0, cDG1.width, cDG1.height);
            cDG1.removeEventListener("click", canvasClick, false);
            cDG1.addEventListener("click", canvasClick, false);
            clicked = false;
            if (num == 1) {
                //cDG1.removeEventListener("click", canvasClick, false);
                registra("canvasClick First addEventListener");
                coordsY = suspendObject.caliEvalua;
                registra("coordsY.length " + coordsY.length);
                $("#tab01").css("background-color", "#3a3e42");
                //setTimeout("drawGraph1()",200);
            } else if (num == 2) {
                //cDG1.addEventListener("click", canvasClick, false);
                registra("canvasClick First addEventListener");
                coordsY = suspendObject.caliAbility;
                registra("coordsY.length " + coordsY.length);
                $("#tab02").css("background-color", "#3a3e42");

            } // else 
            cols = coordsY.length;
            createGrid(cols, 5);
            setTimeout("drawGraph1()", 200);
        } // changeTab

        function createGrid(_cols, _rows) {
            stepW = parseInt(cDG1.width / _cols, 10);
            stepH = parseInt(cDG1.height / _rows, 10);
            //registra("createGrid - stepW: " + stepW);
            //alert("stepW " + stepW);
            contextDG1.beginPath();
            contextDG1.strokeStyle = "#FFFFFF";
            contextDG1.setLineDash([5, 2]);
            contextDG1.lineWidth = 1;
            var tmpWidth = stepW * _cols;
            var tmpHeight = stepH * _rows;
            for (i = 1; i <= tmpWidth; i += stepW) { // Columnas
                //registra("createGrid i: " +i);
                contextDG1.moveTo(i, 1);
                contextDG1.lineTo(i, tmpHeight);
            } // for i 
            contextDG1.moveTo(tmpWidth, 1);
            contextDG1.lineTo(tmpWidth, tmpHeight);
            contextDG1.stroke();
            contextDG1.closePath();
            contextDG1.beginPath();
            contextDG1.strokeStyle = "#FFFFFF";
            contextDG1.setLineDash([5, 2]);
            contextDG1.lineWidth = 0.3;
            var midWidth = parseInt((stepW / 2), 10);
            for (i = 1; i <= _cols; i++) { // divisón de columnas
                contextDG1.moveTo(midWidth, 1);
                contextDG1.lineTo(midWidth, tmpHeight);
                midWidth += stepW;
            } // for i midWidth
            contextDG1.stroke();
            contextDG1.closePath();
            contextDG1.beginPath();
            contextDG1.strokeStyle = "#FFFFFF";
            contextDG1.setLineDash([2, 2]);
            contextDG1.lineWidth = 0.6;
            for (j = 1; j <= tmpHeight; j += stepH) { // Renglones
                contextDG1.moveTo(1, j);
                contextDG1.lineTo(tmpWidth, j);
            } // for j
            contextDG1.moveTo(1, tmpHeight);
            contextDG1.lineTo(tmpWidth, tmpHeight);
            contextDG1.stroke();
            contextDG1.closePath();
        } // createGrid

        function drawGraph1() {
            registra("drawGraph1 - stepW: " + stepW);
            var init = parseInt(stepW / 2, 10);
            var cont = init;
            //var len = 55;
            var len = stepW;
            var y = 195;
            var radius = 8;
            var color = graphMain.graphColor; //"#00bad0"
            circles = new Array();
            //registra("linedash: " + linedash) ;
            contextDG1.clearRect(0, 0, cDG1.width, cDG1.height);
            contextDG1.beginPath();
            contextDG1.strokeStyle = graphMain.graphColor; // "#00bad0";
            contextDG1.fillStyle = graphMain.graphColor; //"#00bad0";
            contextDG1.lineCap = "square";
            contextDG1.lineWidth = 0.5;
            for (i = 0; i < coordsY.length; i++) {
                var tmpStrokeStyle = contextDG1.strokeStyle;
                var tmpFillStyle = contextDG1.fillStyle;
                //registra("coordsY[i] "+ coordsY[i] + " cDG1.height: " + cDG1.height);
                if (coordsY[i] >= cDG1.height) {
                    tmpStrokeStyle = contextDG1.strokeStyle;
                    tmpFillStyle = contextDG1.fillStyle;
                    contextDG1.strokeStyle = "#6E6F71";
                    contextDG1.fillStyle = "#bebebf";
                    color = "#bebebf";
                } // coordsY[i] >= cDG1.height
                contextDG1.arc(cont, y, radius, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false);
                contextDG1.arc(cont, y, radius - 3, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false);
                contextDG1.moveTo(cont, y);

                tmpCoordsY = (cDG1.height * coordsY[i]) / 100;
                tmpCoordsY = cDG1.height - tmpCoordsY;
                //alert("cDG1.height: " + cDG1.height + "\ncoordsY["+i+"]: " + coordsY[i] + "\n(cDG1.height * coordsY[i])/100: "+((cDG1.height * coordsY[i])/100) +"\ntmpCoordsY: " + tmpCoordsY);
                //circle = new Circle(cont, y, radius, color, coordsY[i]);
                //circle = new Circle(cont, tmpCoordsY, radius, color, tmpCoordsY);
                circle = new Circle(cont, cDG1.height, radius, color, tmpCoordsY);
                // el segundo parámetro es cDG1.height para que tenga animación desde abajo de la gráfica hasta el valor de tmpCoordsY 
                // Si se requiere quitar la animación, se debe asignar tmpCoordsY en lugar de cDG1.height
                //circle.writeProps();
                circles.push(circle);
                cont += len;
                contextDG1.strokeStyle = tmpStrokeStyle;
                contextDG1.fillStyle = tmpFillStyle;
                color = graphMain.graphColor; //"#00bad0";
            } // for i
            contextDG1.stroke();
            contextDG1.closePath();
            moveGraph1();
        } // drawGraph1

        var circle2;
        var circles2 = new Array();
        var timeGraph = 1;
        if (navigator.platform.toLowerCase().indexOf("ipad") != -1) {
            timeGraph = 5;
        } // ipad != -1 // if ipad

        function moveGraph1() {
            registra("moveGraph1...");
            contextDG1.clearRect(0, 0, cDG1.width, cDG1.height);
            createGrid(cols, rows);
            contextDG1.setLineDash(linedash);
            var flag = false;
            for (var i = 0; i < circles.length; i++) {
                var circle = circles[i];
                if (circle.y > circle.maxY) {
                    //circle.y--;
                    circle.y -= 5;
                    flag = true;
                } //if 
                if ((i > 0) && (i < circles.length)) {
                    drawLine(contextDG1, circles[i - 1].x, circles[i - 1].y, circle.x, circle.y);
                } //if
                circle.drawCircle(contextDG1);
            } //for i
            if (flag) {
                setTimeout('moveGraph1()', timeGraph);
            } else {
                //drawBars();
                // 		alert("stepW: " + stepW + "\n" +
                // 			" CDG1.width: " + cDG1.width + "\n" +
                // "document.getElementById(canvasGraph1): " + document.getElementById("canvasGraph1").style.width + "\n" +
                // "CDG1.style.width: " + cDG1.style.width + "\n" );
            } //else // if flag
        } // moveGraph1

        function drawBars(square, maxY, part, cont) {
            //registra("drawBars:  cDG1.height: "+ cDG1.height + " (cDG1.height-maxY):"+ (cDG1.height-maxY) +" maxY: " + maxY + " part: " + part + "  cont: " + cont);
            var globalAlpha = contextDG1.globalAlpha
            contextDG1.globalAlpha = 0.3;
            contextDG1.beginPath();
            contextDG1.fillStyle - "#4f899d";
            var tmpMaxY = parseInt(((cDG1.height - maxY) / part), 10);
            //registra("tmpMaxY: " + tmpMaxY );
            tmpMaxY = tmpMaxY * cont;
            //registra("tmpMaxY: " + tmpMaxY);
            tmpMaxY = cDG1.height - tmpMaxY;
            //registra("tmpMaxY: " + tmpMaxY);
            contextDG1.putImageData(contextDG1Data, 0, 0); // resetea el fondo
            contextDG1.fillRect((square * stepW), tmpMaxY, stepW, cDG1.height);
            contextDG1.closePath();
            contextDG1.globalAlpha = globalAlpha;
            cont++;
            if (cont <= part) { // si es menor o igual a el total de partes, se manda llamar al 
                setTimeout(drawBars, 7, square, maxY, part, cont);
            } else {
                //registra("end drawBars...");
                contextDG1.putImageData(contextDG1Data, 0, 0); // resetea el fondo
                var globalAlpha = contextDG1.globalAlpha
                contextDG1.globalAlpha = 0.3;
                contextDG1.beginPath();
                contextDG1.fillStyle - "#4f899d";
                contextDG1.fillRect((square * stepW), maxY, stepW, cDG1.height);
                contextDG1.closePath();
                contextDG1.globalAlpha = globalAlpha;
                cDG1.addEventListener("click", canvasClick, false);
                registra("addEventListener ... end drawBars");
            } // if cont<=part
        } // drawBars

        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        } // getMousePos

        // cDG1.addEventListener('click', function(evt) {
        //        var mousePos = getMousePos(cDG1, evt);
        //       	var message = '******* Click Mouse position: ' + mousePos.x + ',' + mousePos.y;
        //       	console.log(message);
        //     	}, false);

        function canvasClick(e) {
            //stepW = parseInt(cDG1.width/_cols, 10);
            cDG1.removeEventListener("click", canvasClick);
            var mousePos = getMousePos(cDG1, e);
            var tmpCol = Math.floor(mousePos.x / stepW); // columna clickeada
            var clickX = e.pageX - cDG1.offsetLeft; // Se le resta el desplazamiento izquierdo del canvas 
            var clickY = e.pageY - cDG1.offsetTop; // Se le resta el desplazamiento de arriba del canvas 
            clickX -= cDG1.offsetParent.offsetLeft; // Se le resta el desplazamiento izquierdo del padre del canvas 
            clickY -= cDG1.offsetParent.offsetTop; // Se le resta el desplazamiento de arriba del padre del canvas 
            if (clicked) {
                clicked = false;
                contextDG1.putImageData(contextDG1Data, 0, 0);
                $("#tooltip").fadeOut(200, function() {
                    canvasClick(e); // Espera a que haga el fadeOut para volver a llamar a la función y hacer el fadeIn
                });
                return false;
            } // if clicked
            //var i = Math.floor(mousePos.x/stepW);
            var i = Math.floor(mousePos.x / stepW);
            var circle = circles[i];
            circle.isSelected = true;
            clicked = true;
            isDragging = true;
            var tmpY = 185;
            $("#tooltip").css("background-image", "url(templateImages/cajaTexto.png)");
            //registra("i: "+i + " - abilityItemsArray["+i+"].text: " + abilityItemsArray[i].text + " - messages.length: " + abilityItemsArray[i].messages.length); 
            nivel = 0;
            nivelText = " % ";
            if (coordsY[i] != null) {
                nivel = coordsY[i];
            } // if coordsY[i]!=null
            if (tab == 1) {
                for (var j = 0; j < graphPerformance.levels.length; j++) {
                    if (nivel >= graphPerformance.levels[j].min && nivel <= graphPerformance.levels[j].max) {
                        nivelText += graphPerformance.levels[j].text;
                    } // if min max	
                    $("#tooltip").css({
                        "font-size": "12pt",
                        "padding": "10px",
                    });
                    $("#tooltip").html(graphPerformance.messages[i].title.replace(/\\n/g, "<br/>") + '<br/>' + nivel + nivelText);
                } // for j
            } else if (tab == 2) {
                numMessage = 0;
                stars = '<img src="templateImages/estrellaEmpty.png"/><img src="templateImages/estrellaEmpty.png"/><img src="templateImages/estrellaEmpty.png"/>';
                for (var j = 0; j < starsArray.length; j++) {
                    if (nivel >= starsArray[j].min && nivel <= starsArray[j].max) {
                        nivelText += starsArray[j].text; //--jc
                        registra("j: " + j);
                        registra("nivelText " + starsArray[j].text);
                        numMessage = starsArray[j].number - 1;
                        registra("starsArray[j].number: " + starsArray[j].number);
                        stars = "";
                        for (var k = 0; k < starsArray[j].number; k++) {
                            stars += '<img src="templateImages/estrella.png"/>';
                        } //for k
                        for (var k = starsArray[j].number; k < 3; k++) {
                            stars += '<img src="templateImages/estrellaEmpty.png"/>';
                        } // for k
                    } // if 
                } // for j
                registra("numMessage: " + numMessage);
                registra("abilityItemsArray[i].text: " + abilityItemsArray[i].text);
                $("#tooltip").css({
                    "font-size": "10pt",
                    "padding": "10px",
                });
                $("#tooltip").html(abilityItemsArray[i].text + '<br/>' + stars + '<br/>' + abilityItemsArray[i].messages[numMessage].text + '<br/>' + nivel + nivelText);
            } //else if tab==2
            //$("#tooltip").css("top", e.pageY-tmpY);
            $("#tooltip").css("top", circle.maxY - 70);
            //$("#tooltip").css("top", mousePos.y);
            //registra("e.pageY-110: " + (e.pageY-510));
            //$("#tooltip").css("left", e.pageX-550);

            //$("#tooltip").css("left", circle.x);
            registra("clickX: " + clickX);
            registra("circle.x: " + circle.x);
            registra("mousePos.x:  " + mousePos.x);
            registra("canvasGraph1 top:" + $("#canvasGraph1").offset().top);
            registra("canvasGraph1 left:" + $("#canvasGraph1").offset().left);
            registra("canvasGraph1 offset left + circle.x: " + ($("#canvasGraph1").offset().left + circle.x));
            //$("#tooltip").css("left", ($("#canvasGraph1").offset().left +circle.x));

            $("#tooltip").css("left", mousePos.x);

            registra("circles.length " + circles.length);
            registra("i  " + i);

            if ((circle.maxY) < 50) {
                $("#tooltip").css("top", circle.maxY + 70);
                registra("circle.maxY+70: " + circle.maxY + 70);
                $("#tooltip").css("background-image", "url(templateImages/cajaTextoR.png)");
            } //if

            if (i >= circles.length - 3) {
                $("#tooltip").css("left", circle.x - 250);
                registra("circle.x-250: " + circle.x - 250);
                $("#tooltip").css("background-image", "url(templateImages/cajaTextoL.png)");
            } // if 

            $("#tooltip").fadeIn(300);
            //registra("context.save()");
            contextDG1Data = contextDG1.getImageData(0, 0, cDG1.width, cDG1.height);
            //registra("drawBars()");
            drawBars(i, circle.maxY, 10, 1);

            if (!(clicked)) {
                cDG1.addEventListener("click", canvasClick, false);
                registra("clicked false addEventListener...");
            } // if ! clicked se agrega el evento 
        } //canvasClick

        function drawGraph2() {
            var init = 30;
            var contDG2 = init;
            var len = 45;
            var y = 140;
            var radius = 3;
            var color = graphMain.graphColor; //"#00bad0";
            circles2 = new Array();
            contextDG2.clearRect(0, 0, cDG2.width, cDG2.height);
            contextDG2.beginPath();
            contextDG2.strokeStyle = graphMain.graphColor; //"#00bad0";
            contextDG2.fillStyle = graphMain.graphColor; //"#00bad0";
            contextDG2.lineCap = "square";
            contextDG2.lineWidth = 2;
            contextDG2.arc(contDG2, y, radius, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false);
            contextDG2.fill();
            contextDG2.moveTo(contDG2, y);
            circle2 = new Circle(contDG2, y, radius, color, coordsY2[0]);
            circles2.push(circle2);
            contDG2 += len;
            contextDG2.arc(contDG2, y, radius, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false);
            circle2 = new Circle(contDG2, y, radius, color, coordsY2[1]);
            circles2.push(circle2);
            contextDG2.fill();
            contextDG2.lineTo(contDG2, y);
            contDG2 += len;
            contextDG2.arc(contDG2, y, radius, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false);
            circle2 = new Circle(contDG2, y, radius, color, coordsY2[2]);
            circles2.push(circle2);
            contextDG2.fill();
            contextDG2.lineTo(contDG2, y);
            contDG2 += len;
            contextDG2.arc(contDG2, y, radius, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false);
            circle2 = new Circle(contDG2, y, radius, color, coordsY2[3]);
            circles2.push(circle2);
            contextDG2.fill();
            contextDG2.lineTo(contDG2, y);
            contDG2 += len;
            contextDG2.arc(contDG2, y, radius, (Math.PI / 180) * 0, (Math.PI / 180) * 360, false);
            circle2 = new Circle(contDG2, y, radius, color, coordsY2[4]);
            circles2.push(circle2);
            contextDG2.fill();
            contextDG2.lineTo(contDG2, y);
            contextDG2.stroke();
            contextDG2.closePath();
            setTimeout('moveGraph2()', 200);
        } // drawGrpah2

        function moveGraph2() {
            registra("moveGraph2 ... ");
            //registra("width: " + c.width + " - height " + c.height);
            contextDG2.clearRect(0, 0, 500, 200);
            var flag = false;
            for (var i = 0; i < circles2.length; i++) {
                var circle2 = circles2[i];
                if (circle2.y > circle2.maxY) {
                    circle2.y--;
                    flag = true;
                } //if 
                if ((i > 0) && (i < circles2.length)) {
                    drawLine(contextDG2, circles2[i - 1].x, circles2[i - 1].y, circle2.x, circle2.y);
                } //if
                circle2.drawCircle(contextDG2);
            } //for i
            if (flag) {
                setTimeout('moveGraph2()', 5);
            } // if flag
            else {
                //registra("******************* Solo para ver las coordenadas Finales");
                for (i = 0; i < circles2.length; i++) {
                    //	registra("circles["+i+"]: X "+ circles2[i].x + " Y " + circles2[i].y);
                } //for i
            } //else 
        } // moveGraph2

        function Circle(x, y, radius, color, maxY) {
            this.x = x;
            this.y = y;
            this.maxY = maxY;
            this.radius = radius;
            this.color = color;
            this.drawCircle = drawCircle;
            this.writeProps = writeProps;
            this.writeProps();
        } //Circle object

        function drawCircle(ctx) {
            // ctx.beginPath();
            // ctx.moveTo(this.x, this.y);
            //  	ctx.arc(this.x, this.y, this.radius, 0, (Math.PI/180)*360, false);
            //  	ctx.fillStyle = this.color;
            //  	ctx.fill();
            //   ctx.strokeStyle = this.color;
            //   ctx.stroke();
            //   ctx.closePath();
            ctx.beginPath();
            ctx.lineWidth = 1;
            //ctx.arc(this.x, this.y, this.radius, 0, (Math.PI/180)*360, false); // círculo exterior
            ctx.arc(this.x, this.y, this.radius, 0, (Math.PI / 180) * 360, false); // círculo exterior
            ctx.strokeStyle = this.color;
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.strokeStyle = this.color;
            //ctx.arc(this.x, this.y, this.radius-4, 0, (Math.PI/180)*360, false); // círculo central
            ctx.arc(this.x, this.y, this.radius - 4, 0, (Math.PI / 180) * 360, false); // círculo central
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.stroke();
            ctx.closePath();
        } //drawCircle method Circle object

        function drawLine(ctx, x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.closePath();
        } //drawLine

        function writeProps() {
            registra("writeProps x: " + this.x + " - y: " + this.y + " - radius: " + this.radius + " - color: " + this.color + " - maxY: " + this.maxY);
        } //writeProps

        // $("#canvasGraph1").mousemove(function ( e ) {

        //     		var pos   = $(this).offset();
        //     		var elPos = { X:pos.left , Y:pos.top };
        //     		var mPos  = { X:e.clientX-elPos.X, Y:e.clientY-elPos.Y };

        //for (i=0; i<circles.length; i ++) { 
        //	if ((circles[i].x==mPos.X) && (circles[i].y==mPos.Y)) {
        //registra("Mouse position x:"+ mPos.X +" y:"+ mPos.Y); 	
        //		}// if 


        //	}// for i 

        //});

        //	$("#canvasGraph1").click(function ( e ) {

        //		var pos   = $(this).offset();
        //		var elPos = { X:pos.left , Y:pos.top };
        //		var mPos  = { X:e.clientX-elPos.X, Y:e.clientY-elPos.Y };

        //for (i=0; i<circles.length; i ++) { 
        //	if ((circles[i].x==mPos.X) && (circles[i].y==mPos.Y)) {
        //registra("Position x:"+ elPos.X +" y:"+ elPos.Y); 	
        //registra("Mouse position x:"+ mPos.X +" y:"+ mPos.Y); 	
        //		}// if 


        //	}// for i 

        //	});
        // ============================== Graph Modules ===============================================
        var scale = 110;
        var posY = 150;
        var posX = 15;
        var fontSizeTitle = 14;
        var imageExamenFinalOn = new Image();
        var imageExamenFinalOff = new Image();
        // imageExamenFinalOn.src = "templateImages/Abierto_3_.png";
        // imageExamenFinalOff.src = "templateImages/Cerrado_4_.png";
        var step = 4;
        var cont = 0;
        var idTimeout;

        var isEvalEnabled = true; /// variable global para llevar el control del candado para entrar a la evaluación

        // document.getElementById("canvasMod01").addEventListener("click", modCanvasClick, false);
        // document.getElementById("canvasMod02").addEventListener("click", modCanvasClick, false);
        // document.getElementById("canvasMod03").addEventListener("click", modCanvasClick, false);
        // document.getElementById("canvasMod04").addEventListener("click", modCanvasClick, false);
        // document.getElementById("canvasMod05").addEventListener("click", modCanvasClick, false);
        // document.getElementById("canvasExamenFinal").addEventListener("click", modCanvasClick, false);

        /*
			modCanvasClick - Manejador de evento click de cada recuadro de los módulos.
			Parámetros e: evento
		  */
        function modCanvasClick(e) {
            var source = e.target.id.toUpperCase();
            if ((source == "CANVASEXAMENFINAL") && (isEvalEnabled)) { // Entra al examen final
                //alert("Go to Examen final");
                registra("Go to Examen final ...");
                closeTem();
                closeMap();
                loadAssessment();
                return false; // Sale de la función
            } // ExamenFinal
            //var tmpCanvas = document.getElementById(e.target.id);

            $("#canvasMod01").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");
            $("#canvasMod02").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");
            $("#canvasMod03").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");
            $("#canvasMod04").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");
            $("#canvasMod05").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");

            //$("#"+e.target.id).css("background-color", "#3663b1");
            if (source == "CANVASMOD01") {
                showTem(1);
            } else if (source == "CANVASMOD02") {
                showTem(2);
            } else if (source == "CANVASMOD03") {
                showTem(3);
            } else if (source == "CANVASMOD04") {
                showTem(4);
            } else if (source == "CANVASMOD05") {
                showTem(5);
            } // else Canvas Mod 01 02 03 04 05
        } //modCanvasClick

        /*
			Función que muestra el temario del módulo seleccionado en el manejador de eventos
		 */
        function showTem(num) {
            // cambiar color del módulo seleccionado
            // obtener el temario del módulo seleccionado
            // calcular para dividir en las 2 columnas
            // escribir título del módulo
            // escribir temario y check box
            content = "<div class='text-left;'><img src='templateImages/regresarModulo.png' style='cursor:pointer;' onclick=\"closeTem();\"'></div><br/>";
            content += "<table border='0' width='100%'><tr><td width='50%' style='vertical-align: top;'>";
            content += "<div class='temasTitulo' style='font-size:20px;font-weight:bold;' class='text-left'>" + modulesArray[num - 1].name + "</div></td></tr></table>";
            content += "<table border='0' width='100%'><tr><td width='50%' style='vertical-align: top;'>";
            //content +="<ol class='text-left'>";
            for (i = 0; i < modulesArray[num - 1].topics.length; i++) {
                if (i == 7) { // 8
                    //content +="</ol>";
                    //content += "</div></div>";
                    //content += "<div class='row'><div class='col-lg-6 col-md-6 col-sm-6 col-xs-6'>";
                    content += "</td><td width='50%' style='vertical-align:top;'>";
                    //content +="<ol start='10' class='text-left'>";
                } // if i==8
                registra(modulesArray[num - 1].topics[i].name + " - " + modulesArray[num - 1].topics[i].bookmark);
                registra("suspendObject.M[" + (num - 1) + "].t[" + i + "]._b" + suspendObject.M[num - 1].t[i]._b);
                var background = "";
                if (suspendObject.M[num - 1].t[i]._b) {
                    //background="background-color:#487FD7;";
                    background = "background-color:" + graphMain.graphColor + ";";
                } //if visited
                content += "<table border='0'width='100%'>";
                content += "<tr><td class='temasTema' style='width: 70%; font-size:16px;'><span style='cursor:pointer;' onClick=\"current=" + modulesArray[num - 1].topics[i].bookmark + ";closeTem();closeMap();loadSlide();\">" + (i + 1) + ". " + modulesArray[num - 1].topics[i].name + "</span>"
                content += "</td><td style='text-align:right;padding-right:20px;'><canvas id=\"canvasCheck_" + (num - 1) + "_" + i + "\" width=\"15px\" height=\"15px\" class=\"img-responsive canvasCheck\" style=\"display:inline;cursor:pointer;border:solid thin " + graphMain.graphColor + ";" + background + "\" onClick=\"current=" + modulesArray[num - 1].topics[i].bookmark + ";closeTem();closeMap();loadSlide();\"></canvas></td></tr></table>";
            } // for i
            if (modulesArray[num - 1].topics.length < 10) {
                content += "</td><td width='50%' style='vertical-align:top;'>";
            }
            //content +="</ol>";
            //content += "</div></div>";
            content += "</td></tr></table>";
            $("#divTem").html(content);
            // -- jc

            laEscalaWidth = $(window).width();
            console.log('laEscalaWidth', laEscalaWidth);
            if (laEscalaWidth <= 1200) {
                $(".temasTitulo").css({
                    "font-size": (laEscalaWidth / 8) + "%"
                })
                $(".temasTema").css({
                    "font-size": (laEscalaWidth / 13) + "%"
                })
                $(".canvasCheck").css({
                    "width": (laEscalaWidth / 70) + "px"
                })
            }

            registra("showTem...");
            $("#divGraphs").hide();
            // $("#divCirc").hide();
            $("#avanceTotal").hide();
            $("#divTem").fadeIn(400);
            // mostrar el div del temario
        } //showTerm

        function closeTem() {
            $("#canvasMod01").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");
            $("#canvasMod02").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");
            $("#canvasMod03").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");
            $("#canvasMod04").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");
            $("#canvasMod05").css("background-color", graphModules.squareSelectedBackgroundColor); //"#1D1F23");

            $("#divGraphs").fadeIn(400);
            // $("#divCirc").fadeIn(400);
            $("#avanceTotal").fadeIn(400);
            $("#divTem").hide();
        } // closeTem

        function doModules() {
            for (var i = 0; i < modulesArray.length; i++) {
                var tmpStr1 = modulesArray[i].name.split(".")[1];
                registra("--- doModules " + tmpStr1.length + " - " + tmpStr1);
                createModule("canvasMod0" + (i + 1), "Módulo " + (i + 1) + "\n" + tmpStr1, "Módulo", modulesArrayPercentage[i], false, true, null, null);
            } // for i 
            createModule("canvasExamenFinal", "", "Examen Final", 0, true, true, null, null);
        } // doModules

        function createModule(cnv, message, moduleName, percentage, isEval, isEnabled, imageOn, imageOff) {
            var c = document.getElementById(cnv); // canvas
            var ctx = c.getContext("2d"); // contexto
            // Marco del módulo
            ctx.beginPath();
            ctx.lineWidth = 5;
            ctx.strokeStyle = graphModules.squareBackgroundColor; //graphModules.progressBackgroundColor;// "#3F4456";
            var cheight = c.height - 20;
            ctx.rect(0, 0, c.width, cheight);
            ctx.stroke();
            ctx.closePath();
            var metrics = ctx.measureText(message);
            ctx.fillStyle = contentModules.textColor; //"#9faabc";
            ctx.font = " " + fontSizeTitle + "px RobotoRegular";
            //ctx.fillText (moduleName, 5, c.height);
            registra("createModule - isEnabled: " + isEnabled);
            if (isEval) {
                metrics = ctx.measureText("Examen Final");
                ctx.fillText("Examen Final", (c.width - metrics.width) / 2, 24);
                if (isEnabled) {
                    registra("imageExamenFinalOn");
                    ctx.drawImage(imageExamenFinalOn, (c.width - imageExamenFinalOn.width) / 2, (cheight - imageExamenFinalOn.height) / 2);
                } else {
                    registra("imageExamenFinalOff");
                    ctx.drawImage(imageExamenFinalOff, (c.width - imageExamenFinalOff.width) / 2, (cheight - imageExamenFinalOff.height) / 2);
                } //else // isEnabled
                return true;
            } // is Eval
            //  0 %
            ctx.font = "12px RobotoRegular";
            ctx.fillStyle = graphModules.progressBackgroundColor; // "#3F4456";
            ctx.fillStyle = graphModules.progressBackgroundColor; //  "#3F4456";
            ctx.fillText("0%", scale - 5, posY - 5);

            // título del módulo
            ctx.font = " " + fontSizeTitle + "px RobotoRegular";
            ctx.fillStyle = contentModules.textColor; //"#9faabc";
            if (message.indexOf("\n") > -1) { // Si tiene Módulo #
                var messages = message.split("\n");
                var arrTmp = messages[1].split(" ");
                var lines = new Array();
                var j = 1;
                var tmpStr = "";
                var tmpStr = "";
                lines.push(messages[0]);
                registra("arrTmp.length: " + arrTmp.length);
                for (var i = 0; i < arrTmp.length; i++) {
                    tmpStr += " " + arrTmp[i];
                    //registra("for i: " + i + " - " +arrTmp[i]);
                    metrics = ctx.measureText(tmpStr);
                    if (metrics.width < 100) {
                        tmpStr1 = tmpStr;
                        //registra("tmpStr1+= --> " + tmpStr1);
                    } else {
                        //registra("lines.push: " + tmpStr1);
                        lines.push(tmpStr1);
                        tmpStr1 = arrTmp[i];
                        tmpStr = arrTmp[i];
                    } //else // if  metrics.width <172
                    if (i == arrTmp.length - 1) {
                        lines.push(tmpStr1);
                    } //if 
                } // for i arrTmp.length
                // registra("************************************** lines.length:"+lines.length);
                // for (i=0; i<lines.length; i++){
                // 	registra(" lines["+ i + "]: " + lines[i]);
                // }// for i lines.length

                registra("lines.length: " + lines.length);
                var y = ((cheight - (fontSizeTitle * lines.length)) / 3);
                registra("y: " + y);
                metrics = ctx.measureText(lines[0]); // Sólo el título "Módulo #"
                ctx.fillText(lines[0], (c.width - metrics.width) / 2, y);
                y += 5 + fontSizeTitle;

                for (i = 1; i < lines.length; i++) {
                    registra("lines[" + i + "]:" + lines[i]);
                    metrics = ctx.measureText(lines[i]);
                    ctx.fillText(lines[i], (c.width - metrics.width) / 2, y);
                    y += 5 + fontSizeTitle;
                    registra("metrics.width: " + metrics.width);
                } // for i lines
            } else {
                registra(metrics.width);
                ctx.fillText(message, (c.width - metrics.width) / 2, (cheight - fontSizeTitle) / 2);
            } //else // indexOf("\n")
            // progress bar
            ctx.beginPath();
            ctx.lineWidth = 5;
            ctx.strokeStyle = graphModules.progressBackgroundColor; // "#3F4456";
            ctx.fillStyle = graphModules.progressBackgroundColor; //"#3F4456";
            ctx.rect(posX, posY, scale + 10, 11);
            ctx.fill();
            ctx.stroke();
            ctx.closePath();
            // if (percentage > 0) {
            drawGraphModule(percentage, ctx, c, 0);
            // }
        } // createModule

        // dibuja el contenido del módulo
        function drawGraphModule(_max, ctx, c, _cont) {
            max = Math.floor(scale * _max) / 100;
            var cont = _cont;
            ctx.clearRect(posX, posY - 15, c.width - 20, 40);
            ctx.beginPath();
            ctx.lineWidth = 5;
            ctx.strokeStyle = graphModules.progressBackgroundColor; //para el fondo de la barra de progreso  //"#3F4456"; 
            ctx.fillStyle = graphModules.progressBackgroundColor; //para el fondo de la barra de progreso //"#3F4456";
            ctx.rect(posX, posY, scale + 10, 11);
            ctx.fill();
            ctx.stroke();
            ctx.closePath();
            cont += step;
            ctx.font = "Bold 12px RobotoRegular";
            ctx.fillStyle = graphModules.progressColor; // para el texto del porcentaje // "#61aaeb"; 
            if (_max > 0) {
                var porcentajeModulo = Math.floor((cont * 100) / scale);
                if (porcentajeModulo >= 100) {
                    porcentajeModulo = 100;
                }
                ctx.fillText(porcentajeModulo + "%", scale - 10, posY - 5);
            } else {
                ctx.fillText("0%", scale - 10, posY - 5);
            }
            ctx.beginPath();
            ctx.strokeStyle = graphModules.progressColor; //para la barra de progreso //"#61aaeb"; 
            ctx.fillStyle = graphModules.progressColor; //para la barra de progreso // "#61aaeb";
            ctx.rect(posX + 5, posY + 5, cont, 1);
            ctx.fill();
            ctx.stroke();
            ctx.closePath();
            if (cont < max) {
                idTimeout = setTimeout(drawGraphModule, 1, _max, ctx, c, cont);
            } //if
        } //drawGraphModule()

        /*      Función para limpiar los canvas
        		Parámetros: 
        			_canvas: el id de la etiqueta canvas en el documento.
        */
        function clearCanvas(_canvas) {
            var _c = document.getElementById(_canvas); // canvas
            if (_c != null) { // siempre y cuando exista
                var _ctx = _c.getContext("2d"); // contexto
                _ctx.clearRect(0, 0, _c.width, _c.height); // limpiar
            } // if _c != null
        } //clearCanvas




        var canvasProgress01;
        var ctx01;

        function mainProgress(prog) {
            canvasProgress01 = document.getElementById("canvasProgress");
            ctx01 = canvasProgress01.getContext("2d");
            ctx01.beginPath();
            // Background progress
            ctx01.fillStyle = "#898DA5";
            roundRect(ctx01, 0, 0, canvasProgress01.width, canvasProgress01.height, 0, true, false);
            ctx01.fill();
            ctx01.stroke();
            // Foreground progress
            ctx01.strokeStyle = "#4AAA42"; //graphModules.progressColor;//"#B42184";//"#487FD7";
            ctx01.fillStyle = "#4AAA42"; //"#B42184";//"#487FD7";
            roundRect(ctx01, 0, 0, ((prog * canvasProgress01.width) / 100), canvasProgress01.height, 0, true, false);
            // Fill both
            ctx01.fill();
            // Stroke both
            ctx01.stroke();
            // separators
            ctx01.lineWidth = 3;
            ctx01.strokeStyle = "#254468";
            var factor = Math.ceil(canvasProgress01.width / 30);
            for (i = 1; i <= 31; i++) {
                ctx01.moveTo(factor * i, 0);
                ctx01.lineTo(factor * i, canvasProgress01.height);
            } //for i
            ctx01.stroke();
            ctx01.closePath();
            //#4d4d4d //  gris
            // #ffd100 // amarillo
        } // mainProgress

        function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
            if (typeof stroke == 'undefined') {
                stroke = true;
            } // if stroke
            if (typeof radius === 'undefined') {
                radius = 5;
            } // if radius
            if (typeof radius === 'number') {
                radius = {
                    tl: radius,
                    tr: radius,
                    br: radius,
                    bl: radius
                };
            } else {
                var defaultRadius = {
                    tl: 0,
                    tr: 0,
                    br: 0,
                    bl: 0
                };
                for (var side in defaultRadius) {
                    radius[side] = radius[side] || defaultRadius[side];
                } // for
            } //else 
            ctx.beginPath();
            ctx.moveTo(x + radius.tl, y);
            ctx.lineTo(x + width - radius.tr, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
            ctx.lineTo(x + width, y + height - radius.br);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
            ctx.lineTo(x + radius.bl, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
            ctx.lineTo(x, y + radius.tl);
            ctx.quadraticCurveTo(x, y, x + radius.tl, y);
            ctx.closePath();
            if (fill) {
                ctx.fill();
            } // if fill
            if (stroke) {
                ctx.stroke();
            } // if stroke
        } // roundRect



        //// funciones de controles de audio y animación para pantallas de Tumult.
        var hdocument;
        var helement;
        var audio1;

        function sendDocumentReference(hd) {
            hdocument = hd;
            registra("sendDocumentReference");
            //audio1 = document.getElementById('audio1');
            //audio1= new Audio("content/cur_w10_m1_p01_prueba4/cur_w10_m1_p01_prueba4.hyperesources/au_win_m1_p1.mp3");
            //registra("resources: " + hdocument.resourcesFolderURL()+"/au_win_m1_p1.mp3");
            registra("resources: " + hdocument.resourcesFolderURL() + "/" + topicsArray[current - 1].audioFile);
            //audio1= new Audio(hdocument.resourcesFolderURL()+"/au_win_m1_p1.mp3");
            audio1 = new Audio(hdocument.resourcesFolderURL() + "/" + topicsArray[current - 1].audioFile);
            registra("load audio1");
            //helement=hdocument.getElementById("btnComenzar");
        } //aguacate

        function sendButtonReference(e) {
            helement = e; /// btnComenzar
            registra("sendButtonReference");
            //document.getElementById("btnGetData").click();
            if ((navigator.platform.toLowerCase().indexOf("ipad") == -1) &&
                (navigator.platform.toLowerCase().indexOf("ipod") == -1) &&
                (navigator.platform.toLowerCase().indexOf("iphone") == -1)) {
                registra("sendButtonReference NOT iPad, iPod, iPhone *********");
                if (helement != null) {
                    registra("sendButtonReference helement NOT NULL");
                    registra(helement.innerHTML);
                    //helement.style.display="none";
                    $(helement).hide(); /// ocultar btnComenzar	
                } else {
                    registra("sendButtonReference helement is NULL");
                } //else //if helement != null

            } //if not ipad ipod iphone
            getData();
        } // guacamole

        function pauseAnim() {
            if ((navigator.platform.toLowerCase().indexOf("ipad") == -1) &&
                (navigator.platform.toLowerCase().indexOf("ipod") == -1) &&
                (navigator.platform.toLowerCase().indexOf("iphone") == -1)) {
                registra("pauseAnim NOT iPad, iPod, iPhone *********");
                //$(e).hide(); /// ocultar btnComenzar
                //helement=hdocument.getElementById("btnComenzar");
                registra("helement: " + helement);
                //helement=hdocument.getElementById("hype-obj-VV6NF6MZDC1LJGL0WYUL");
                //registra("helement: " + helement);
                if (helement != null) {
                    registra("pauseAnim helement NOT NULL");
                    helement.style.display = "none";
                    $(helement).hide();
                } else {
                    registra("pauseAnim helement is NULL");
                } //else // if (helement!=null)
                registra("pauseAnim audio1.play()");
                audio1.play();
            } else {
                //hdocumen.goToTimeInTimelineNamed(1, 'kTimelineDefaultIdentifier');
                hdocument.pauseTimelineNamed('kTimelineDefaultIdentifier');
                audio1.pause();
            } //else // if not ipad ipod iphone
        } //

        function initAnim(e) {
            hdocument.continueTimelineNamed('kTimelineDefaultIdentifier', hdocument.kDirectionForward, false);
            registra("initAnim ... audio1.play");
            audio1.play();
            if (e != null) {
                registra("initAnim e NOT NULL");
                e.style.display = "none";
                $(e).hide();
            } else {
                registra("initAnim e is NULL");
            } //else //if e!=null
        } // initAnim // función llamada desde la página creada en tumult.

        function getData() {
            //document.getElementById("btnGetData").innerHTML="init getData();";
            //audio1.play();
            registra("helement: " + helement.id);
            registra("documentName: " + hdocument.documentName());
            registra("documentId: " + hdocument.documentId());
            registra("sceneNames: " + hdocument.sceneNames());
            registra("currentSceneName: " + hdocument.currentSceneName());
            registra("functions: " + hdocument.functions());
            //registra("HYPE.documents.length " + HYPE.documents.length);
            //registra("HYPE.documents " + HYPE.documents);
            registra("hypeDocument.resourcesFolderURL(): " + hdocument.resourcesFolderURL());
            registra("_pW10_1: " + hdocument.getElementById("_pW10_1"));
            registra("au_win_m1_p1: " + hdocument.getElementById("au_win_m1_p1"));
            registra("63: " + hdocument.getElementById("63"));

            //	registra (": " + hdocument.getElementById(""));
        } //getData

        function muteAudio1() {
            audio1.volume = 0;
        } //muteAudio1

        function unMuteAudio1() {
            audio1.volume = 1;
        } //muteAudio1

        function continueTimeLine() {
            hdocument.continueTimelineNamed('kTimelineDefaultIdentifier', hdocument.kDirectionForward, false);
            audio1.play();
        } //continueTimeLine();

        function pauseTimeLine() {
            //HYPE.documents['cur_w10_m1_p01_prueba'].pauseTimelineNamed('kTimelineDefaultIdentifier');
            hdocument.pauseTimelineNamed('kTimelineDefaultIdentifier');
            audio1.pause();
        } //pauseTimeLine();

        function gotoTimeLine() {

            audio1.currentTime += 5;
            var time = hdocument.currentTimeInTimelineNamed('timelineName') + 5;
            if (time >= hdocument.durationForTimelineNamed('kTimelineDefaultIdentifier')) {
                time = 0;
                audio1.currentTime = -5;
            } //if 
            hdocument.goToTimeInTimelineNamed(time, 'kTimelineDefaultIdentifier');
        } //gotoTimeLine



        ///////////////////////////////////////////// Diploma 
        function showDiploma() {
            generaDiploma(learnername);
        } //showDiploma
        function doCert() {
            generaDiploma(learnername);
        } // doCert
        function generaDiploma(username) {
            var arr = username.split(",");
            var user = "";
            if (arr.length >= 2) {
                user += arr[1];
            } //length>=2
            if (arr.length >= 1) {
                user += " " + arr[0];
            } //length>=1
            var getImageFromUrl = function(url, callback) {
                var img = new Image(),
                    data, ret = {
                        data: null,
                        pending: true
                    };
                img.onError = function() {
                    throw new Error('Cannot load image: "' + url + '"');
                };
                img.onload = function() {
                    var canvas = document.createElement('canvas');
                    document.body.appendChild(canvas);
                    canvas.width = img.width;
                    canvas.height = img.height;
                    var ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    // Grab the image as a jpeg encoded in base64, but only the data
                    //data = canvas.toDataURL('image/jpeg').slice('data:image/jpeg;base64,'.length);
                    data = canvas.toDataURL('image/png').slice('data:image/png;base64,'.length);
                    // Convert the data to binary form
                    data = atob(data);
                    document.body.removeChild(canvas);
                    ret['data'] = data;
                    ret['pending'] = false;
                    if (typeof callback === 'function') {
                        callback(data);
                    }
                };
                img.src = url;
                return ret;
            };
            var meses = new Array("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre");
            var f = new Date();
            var fecha = f.getDate() + " de " + meses[f.getMonth()] + " de " + f.getFullYear()
            var createPDF = function(imgData) {
                var doc = new jsPDF('landscape', 'mm', 'letter'); // portrait  //landscape   // A4
                doc.addImage(imgData, 'PNG', 0, 0, 279, 216, undefined, 'fast'); //  162mm -> 612px - 210mm ->793mm   // letter   /// fast medium slow
                doc.setFontSize(22);
                doc.setFont("verdana");
                var x = parseInt(((279 - 65) - doc.getTextWidth(user)) / 2, 10) + 65;
                doc.text(x, 96, user);
                doc.setFontSize(18);
                doc.setFont("verdana");

                x = parseInt(((279 - 60) - doc.getTextWidth(fecha)) / 2, 10) + 60;
                doc.text(x, 160, fecha);
                var nDate = new Date();
                doc.save('Diploma_AnalisisDeProblemas_' + nDate.getFullYear().toString() + (nDate.getMonth() + 1).toString() + nDate.getDate().toString() + '_' + nDate.getHours().toString() + nDate.getMinutes().toString() + nDate.getSeconds().toString() + '.pdf');
            } // createPDF

            getImageFromUrl('td_diploma.png', createPDF);
        } // generaDiploma


        function setCalificacionModulo(laEvaluacion, laCalificacion) {
            registra('setCalificacionModulo - módulo', laEvaluacion, 'con', laCalificacion);

            evaluaArray[(laEvaluacion - 1)];
            // for (var i = 0; i < evaluaArray.length; i++) {
            // } // for i
            // totI = evaluaArray[(laEvaluacion - 1)];
            // var tot = Math.floor((totI * 100) / total);
            suspendObject.caliEvalua[(laEvaluacion - 1)] = laCalificacion;
            // setScore();
            saveSCORM();
        }

        function setCalificacionFinal(laCalificacion) {
            console.log('setCalificacionFinal', laCalificacion);

            if (lmsConnected) { // Si hay scorm lmsConnected 
                if (scorm.version == "1.2") {
                    scorm.set("cmi.core.score.raw", laCalificacion);
                } else if (scorm.version == "2004") {
                    scorm.set("cmi.score.raw", laCalificacion);
                    scorm.set("cmi.score.scaled", (laCalificacion / 10));
                }
                scorm.save(); //save all data that has already been sent 

                // si todas las pantallas están visitadas
                // setTimeout("completaSCORM()", 500);
            } // lmsConnected
        }


        function completaSCORM() {

            var hayCalificacionFinal = getScore();

            var suspendObject2 = suspendObject;
            var tmpSuspend2 = scorm.get("cmi.suspend_data"); //

            if ((tmpSuspend2.length == 0) || (tmpSuspend2 == undefined) || (tmpSuspend2 == "undefined")) {
                console.log('no hay tmpSuspend');
            } else {
                console.log('get el suspend data es', tmpSuspend2);
                tmpSuspend2 = tmpSuspend2.replace(/\u007C/g, '"');
                console.log('get el nuevo suspendData es', tmpSuspend2);

                suspendObject2 = JSON.parse(tmpSuspend2);

                var contadorLock = 0;
                var totalPantallas = 0;
                for (i = 0; i < suspendObject2.M.length; i++) {
                    for (j = 0; j < suspendObject2.M[i].t.length; j++) {
                        totalPantallas++;
                        console.log('totalPantallas', totalPantallas);

                        lock = suspendObject2.M[i].t[j]._b;
                        if (lock) {
                            contadorLock++;
                            console.log('contadorLock', contadorLock);
                        }

                    }
                }

                for (i = 0; i < suspendObject2.M.length; i++) {
                    for (j = 0; j < suspendObject2.M[i].t.length; j++) {
                        if (contadorLock == totalPantallas) {
                            console.log(totalPantallas, 'todas las pantallas visitadas');

                            if (hayCalificacionFinal >= 80) {
                                if (scorm.version == "1.2") {
                                    scorm.set("cmi.core.lesson_status", "completed");
                                } else if (scorm.version == "2004") {
                                    scorm.set("cmi.success_status", "passed");
                                    scorm.set("cmi.completion_status", "completed");
                                }
                                // } else {
                                //     if (scorm.version == "1.2") {
                                //         scorm.set("cmi.core.lesson_status", "failed");
                                //     } else if (scorm.version == "2004") {
                                //         scorm.set("cmi.success_status", "failed");
                                //         scorm.set("cmi.completion_status", "incomplete");
                                //     }
                            }
                            scorm.save(); //save all data that has already been sent 
                        } else {
                            console.log(totalPantallas, 'todavía faltan pantallas por visitar');
                        }
                    }
                }

                suspendObject.caliFinal = hayCalificacionFinal;
                suspendData = JSON.stringify(suspendObject);

                console.log('el suspend data es', suspendData);
                suspendData = suspendData.replace(/"/g, '|');
                console.log('el nuevo suspend data es', suspendData);

                scorm.set("cmi.suspend_data", suspendData);
                scorm.save(); //save all data that has already been sent 

            }
        }


        ///////////////////////////////////////////// Diploma 
        function showDiploma() {
            generaDiploma(learnername);
        } //showDiploma
        function doCert() {
            generaDiploma(learnername);
        } // doCert
        function generaDiploma(username) {
            var arr = username.split(",");
            var user = "";
            if (arr.length >= 2) {
                user += arr[1];
            } //length>=2
            if (arr.length >= 1) {
                user += " " + arr[0];
            } //length>=1
            var getImageFromUrl = function(url, callback) {
                var img = new Image(),
                    data, ret = {
                        data: null,
                        pending: true
                    };
                img.onError = function() {
                    throw new Error('Cannot load image: "' + url + '"');
                };
                img.onload = function() {
                    var canvas = document.createElement('canvas');
                    document.body.appendChild(canvas);
                    canvas.width = img.width;
                    canvas.height = img.height;
                    var ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    // Grab the image as a jpeg encoded in base64, but only the data
                    //data = canvas.toDataURL('image/jpeg').slice('data:image/jpeg;base64,'.length);
                    data = canvas.toDataURL('image/png').slice('data:image/png;base64,'.length);
                    // Convert the data to binary form
                    data = atob(data);
                    document.body.removeChild(canvas);
                    ret['data'] = data;
                    ret['pending'] = false;
                    if (typeof callback === 'function') {
                        callback(data);
                    }
                };
                img.src = url;
                return ret;
            };
            var meses = new Array("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre");
            var f = new Date();
            var fecha = f.getDate() + " de " + meses[f.getMonth()] + " de " + f.getFullYear()
            var createPDF = function(imgData) {
                var doc = new jsPDF('landscape', 'mm', 'letter'); // portrait  //landscape   // A4
                //doc.addImage(imgData, 'JPEG', 0, 0, 298, 210);
                // var imgWidth = 210; 
                //  	var pageHeight = 295;  
                //  	var imgHeight = imgTmp.height * imgWidth / imgTmp.width;
                //  	var heightLeft = imgHeight;
                //alert("imgHeight: " + imgHeight + "\nimgTmp.height: "+ imgTmp.height +"\nimgTmp.width: " + imgTmp.width);
                //doc.addImage(imgData, 'PNG', 0, 0, 298, 210);   // 298mm -> 1126px - 210mm -> 794px
                //doc.addImage(imgData, 'PNG', 0, 0, 210, 297); //  162mm -> 612px - 210mm ->793mm  // A4
                // doc.addImage(imgData, 'PNG', 0, 0, 216, 279); //  162mm -> 612px - 210mm ->793mm   // letter
                doc.addImage(imgData, 'PNG', 0, 0, 279, 216, undefined, 'fast'); //  162mm -> 612px - 210mm ->793mm   // letter   /// fast medium slow

                doc.setFontSize(22);
                doc.setFont("verdana");
                //doc.setFontType("bold");
                //var x = parseInt( (161-(doc.getTextWidth(user))) ,10);
                var x = parseInt(((279 - 65) - doc.getTextWidth(user)) / 2, 10) + 65;
                //doc.text(70, 100, user);
                doc.text(x, 96, user);
                //doc.setFontSize(18);
                //x = parseInt( (274-(doc.getTextWidth("Microsoft Windows 10"))) ,10);
                //doc.text(x, 90, "Microsoft Windows 10");
                doc.setFontSize(18);
                doc.setFont("verdana");
                //x = parseInt( (161-(doc.getTextWidth(fecha))) ,10);
                //doc.text(80, 160, fecha);

                x = parseInt(((279 - 60) - doc.getTextWidth(fecha)) / 2, 10) + 60;
                doc.text(x, 160, fecha);
                var nDate = new Date();
                doc.save('Diploma_Liderazgo_' + nDate.getFullYear().toString() + (nDate.getMonth() + 1).toString() + nDate.getDate().toString() + '_' + nDate.getHours().toString() + nDate.getMinutes().toString() + nDate.getSeconds().toString() + '.pdf');
                //doc.save('diploma_Windows_10.pdf');
            } // createPDF

            getImageFromUrl('l_diploma.png', createPDF);
        } // generaDiploma



        /////////////////////////////////////////////////////////
        function fatality() {
            var secuencia = "";
            $(document).keydown(function(e) {
                console.log(e.keyCode);
                if (e.keyCode == 38) {
                    if (secuencia == "") {
                        secuencia = "arriba";
                    } else {
                        secuencia = "";
                    }
                    console.log("secuencia: " + secuencia);
                    e.preventDefault();
                }
                if (e.keyCode == 40) {
                    if (secuencia == "arriba") {
                        secuencia = "abajo";
                    } else {
                        secuencia = "";
                    }
                    console.log("secuencia: " + secuencia);
                    e.preventDefault();
                }
                if (e.keyCode == 37) {
                    if (secuencia == "abajo") {
                        secuencia = "izquierda";
                    } else {
                        secuencia = "";
                    }
                    console.log("secuencia: " + secuencia);
                }
                e.preventDefault();
                if (e.keyCode == 39) {
                    if (secuencia == "izquierda") {
                        console.log("Código Activado");
                        lock = true;
                        pantallaDesbloqueada = true;
                        isVisited(current + 1);
                        nextSlide();
                    }
                    console.log("secuencia: " + secuencia);
                    secuencia = "";
                    e.preventDefault();
                }
            });
        }
    </script>
</body>

</html>